<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.1" xml:lang="en-US">
  <compounddef id="IJK__Field__template_8tpp" kind="file" language="C++">
    <compoundname>IJK_Field_template.tpp</compoundname>
    <includes refid="IJK__Shear__Periodic__helpler_8h" local="no">IJK_Shear_Periodic_helpler.h</includes>
    <includes refid="IJK__communications_8h" local="no">IJK_communications.h</includes>
    <includes refid="Domaine__IJK_8h" local="no">Domaine_IJK.h</includes>
    <includes local="no">LataTools.h</includes>
    <includes local="no">LataDB.h</includes>
    <includes refid="EcrFicPartageBin_8h" local="no">EcrFicPartageBin.h</includes>
    <includes local="no">errno.h</includes>
    <includes refid="IJK__Striped__Writer_8h" local="no">IJK_Striped_Writer.h</includes>
    <includes refid="Parallel__io__parameters_8h" local="no">Parallel_io_parameters.h</includes>
    <includes refid="Perf__counters_8h" local="no">Perf_counters.h</includes>
    <includedby refid="IJK__Field__template_8h" local="no">IJK_Field_template.h</includedby>
    <incdepgraph>
      <node id="4">
        <label>errno.h</label>
      </node>
      <node id="3">
        <label>LataDB.h</label>
      </node>
      <node id="1">
        <label>IJK_Field_template.tpp</label>
        <link refid="IJK__Field__template_8tpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>LataTools.h</label>
      </node>
    </incdepgraph>
      <sectiondef kind="define">
      <memberdef kind="define" id="IJK__Field__template_8tpp_1a03b2435276a91449553bdf00559ccb1e" prot="public" static="no">
        <name>IJK_Field_template_TPP_H</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/Kernel/IJK/Champs/IJK_Field_template.tpp" line="17" column="9" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/Kernel/IJK/Champs/IJK_Field_template.tpp" bodystart="17" bodyend="-1"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/****************************************************************************</highlight></codeline>
<codeline lineno="2"><highlight class="comment">*<sp/>Copyright<sp/>(c)<sp/>2025,<sp/>CEA</highlight></codeline>
<codeline lineno="3"><highlight class="comment">*<sp/>All<sp/>rights<sp/>reserved.</highlight></codeline>
<codeline lineno="4"><highlight class="comment">*</highlight></codeline>
<codeline lineno="5"><highlight class="comment">*<sp/>Redistribution<sp/>and<sp/>use<sp/>in<sp/>source<sp/>and<sp/>binary<sp/>forms,<sp/>with<sp/>or<sp/>without<sp/>modification,<sp/>are<sp/>permitted<sp/>provided<sp/>that<sp/>the<sp/>following<sp/>conditions<sp/>are<sp/>met:</highlight></codeline>
<codeline lineno="6"><highlight class="comment">*<sp/>1.<sp/>Redistributions<sp/>of<sp/>source<sp/>code<sp/>must<sp/>retain<sp/>the<sp/>above<sp/>copyright<sp/>notice,<sp/>this<sp/>list<sp/>of<sp/>conditions<sp/>and<sp/>the<sp/>following<sp/>disclaimer.</highlight></codeline>
<codeline lineno="7"><highlight class="comment">*<sp/>2.<sp/>Redistributions<sp/>in<sp/>binary<sp/>form<sp/>must<sp/>reproduce<sp/>the<sp/>above<sp/>copyright<sp/>notice,<sp/>this<sp/>list<sp/>of<sp/>conditions<sp/>and<sp/>the<sp/>following<sp/>disclaimer<sp/>in<sp/>the<sp/>documentation<sp/>and/or<sp/>other<sp/>materials<sp/>provided<sp/>with<sp/>the<sp/>distribution.</highlight></codeline>
<codeline lineno="8"><highlight class="comment">*<sp/>3.<sp/>Neither<sp/>the<sp/>name<sp/>of<sp/>the<sp/>copyright<sp/>holder<sp/>nor<sp/>the<sp/>names<sp/>of<sp/>its<sp/>contributors<sp/>may<sp/>be<sp/>used<sp/>to<sp/>endorse<sp/>or<sp/>promote<sp/>products<sp/>derived<sp/>from<sp/>this<sp/>software<sp/>without<sp/>specific<sp/>prior<sp/>written<sp/>permission.</highlight></codeline>
<codeline lineno="9"><highlight class="comment">*</highlight></codeline>
<codeline lineno="10"><highlight class="comment">*<sp/>THIS<sp/>SOFTWARE<sp/>IS<sp/>PROVIDED<sp/>BY<sp/>THE<sp/>COPYRIGHT<sp/>HOLDERS<sp/>AND<sp/>CONTRIBUTORS<sp/>&quot;AS<sp/>IS&quot;<sp/>AND<sp/>ANY<sp/>EXPRESS<sp/>OR<sp/>IMPLIED<sp/>WARRANTIES,<sp/>INCLUDING,<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO,<sp/>THE<sp/>IMPLIED<sp/>WARRANTIES<sp/>OF<sp/>MERCHANTABILITY<sp/>AND<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE<sp/>ARE<sp/>DISCLAIMED.</highlight></codeline>
<codeline lineno="11"><highlight class="comment">*<sp/>IN<sp/>NO<sp/>EVENT<sp/>SHALL<sp/>THE<sp/>COPYRIGHT<sp/>HOLDER<sp/>OR<sp/>CONTRIBUTORS<sp/>BE<sp/>LIABLE<sp/>FOR<sp/>ANY<sp/>DIRECT,<sp/>INDIRECT,<sp/>INCIDENTAL,<sp/>SPECIAL,<sp/>EXEMPLARY,<sp/>OR<sp/>CONSEQUENTIAL<sp/>DAMAGES<sp/>(INCLUDING,<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO,<sp/>PROCUREMENT<sp/>OF<sp/>SUBSTITUTE<sp/>GOODS<sp/>OR<sp/>SERVICES;<sp/>LOSS<sp/>OF<sp/>USE,<sp/>DATA,<sp/>OR<sp/>PROFITS;</highlight></codeline>
<codeline lineno="12"><highlight class="comment">*<sp/>OR<sp/>BUSINESS<sp/>INTERRUPTION)<sp/>HOWEVER<sp/>CAUSED<sp/>AND<sp/>ON<sp/>ANY<sp/>THEORY<sp/>OF<sp/>LIABILITY,<sp/>WHETHER<sp/>IN<sp/>CONTRACT,<sp/>STRICT<sp/>LIABILITY,<sp/>OR<sp/>TORT<sp/>(INCLUDING<sp/>NEGLIGENCE<sp/>OR<sp/>OTHERWISE)<sp/>ARISING<sp/>IN<sp/>ANY<sp/>WAY<sp/>OUT<sp/>OF<sp/>THE<sp/>USE<sp/>OF<sp/>THIS<sp/>SOFTWARE,<sp/>EVEN<sp/>IF<sp/>ADVISED<sp/>OF<sp/>THE<sp/>POSSIBILITY<sp/>OF<sp/>SUCH<sp/>DAMAGE.</highlight></codeline>
<codeline lineno="13"><highlight class="comment">*</highlight></codeline>
<codeline lineno="14"><highlight class="comment">*****************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>IJK_Field_template_TPP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>IJK_Field_template_TPP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;IJK_Shear_Periodic_helpler.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;IJK_communications.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;Domaine_IJK.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;LataTools.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;LataDB.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;EcrFicPartageBin.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;errno.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;IJK_Striped_Writer.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;Parallel_io_parameters.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;Perf_counters.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="31" refid="classIJK__Field__template_1aa37a9dae1bd207f7f407d8e03be1b6ec" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template_1aa37a9dae1bd207f7f407d8e03be1b6ec" kindref="member">IJK_Field_template&lt;_TYPE_, _TYPE_ARRAY_&gt;::exchange_data</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pe_send_,<sp/></highlight><highlight class="comment">/*<sp/>processor<sp/>to<sp/>send<sp/>to<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>is,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>js,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ks,<sp/></highlight><highlight class="comment">/*<sp/>ijk<sp/>coordinates<sp/>of<sp/>first<sp/>data<sp/>to<sp/>send<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pe_recv_,<sp/></highlight><highlight class="comment">/*<sp/>processor<sp/>to<sp/>recv<sp/>from<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ir,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jr,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>kr,<sp/></highlight><highlight class="comment">/*<sp/>ijk<sp/>coordinates<sp/>of<sp/>first<sp/>data<sp/>to<sp/>recv<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>isz,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jsz,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ksz,<sp/></highlight><highlight class="comment">/*<sp/>size<sp/>of<sp/>block<sp/>data<sp/>to<sp/>send/recv<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>offset,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>jump_i,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nb_ghost)<sp/><sp/></highlight><highlight class="comment">/*<sp/>decallage<sp/>a<sp/>appliquer<sp/>pour<sp/>la<sp/>condition<sp/>de<sp/>shear<sp/>periodique*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal">{</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pe_send_<sp/>==<sp/><ref refid="classProcess_1ab55ba07167ec807ed3a145cac0f5dca4" kindref="member">Process::me</ref>()<sp/>&amp;&amp;<sp/>pe_recv_<sp/>==<sp/><ref refid="classProcess_1ab55ba07167ec807ed3a145cac0f5dca4" kindref="member">Process::me</ref>())</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Self<sp/>(periodicity<sp/>on<sp/>same<sp/>processor)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>*dest<sp/>=<sp/><ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::data</ref>().addr();</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>classical<sp/>variable<sp/>--&gt;<sp/>just<sp/>a<sp/>copy</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(offset<sp/>==<sp/>0.)</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++)</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template" kindref="compound">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(i<sp/>+<sp/>ir<sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k<sp/>+<sp/>kr)]<sp/>=<sp/><ref refid="classIJK__Field__local__template_1afd53b935929ae70388bc3628888dbc17" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::operator()</ref>(i<sp/>+<sp/>is,<sp/>j<sp/>+<sp/>js,<sp/>k<sp/>+<sp/>ks);</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>pressure<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>(zmax)--&gt;<sp/>ghost<sp/>value<sp/>reconstructed<sp/>from<sp/>Isigkappa<sp/>and<sp/>pressure<sp/>interpolation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==1<sp/>&amp;&amp;<sp/>offset<sp/>&lt;0.)</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="58" refid="classIJK__Field__template_1a9c330f12b41547930db9e6cedb736c8c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shear_BC_helpler_.prepare_interpolation_for_shear_periodicity((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>round((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>isz);</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++)</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmin=<sp/>0.;</highlight></codeline>
<codeline lineno="63" refid="classIJK__Field__template_1a5942d9ff62d57d77a11b0dda5d4e91f5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmax=<sp/>0.;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>interpolation_for_shear_periodicity_I_sig_kappa(j<sp/>+<sp/>js,<sp/>k+2,<sp/>k+2,<sp/>interpIsigkappazmin,<sp/>interpIsigkappazmax);</highlight></codeline>
<codeline lineno="65" refid="classIJK__Field__template_1acbbc58e449fe4f1b0f1586c280fad825" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(i<sp/>+<sp/>ir<sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k<sp/>+<sp/>kr)]<sp/>=<sp/>interpolation_for_shear_periodicity_IJK_Field(j<sp/>+<sp/>js,<sp/>k<sp/>+<sp/>ks)<sp/>+<sp/>interpIsigkappazmin-(_TYPE_)<sp/>shear_BC_helpler_.I_sig_kappa_zmax_(i+is<sp/>,<sp/>j+js<sp/>,<sp/>k+2);</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="69" refid="classIJK__Field__template_1a34bf4952e7eeaf178687a1137f9bab1c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>pressure<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>(zmin)--&gt;<sp/>ghost<sp/>value<sp/>reconstructed<sp/>from<sp/>Isigkappa<sp/>and<sp/>pressure<sp/>interpolation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==1<sp/>&amp;&amp;<sp/>offset<sp/>&gt;0.)</highlight></codeline>
<codeline lineno="71" refid="classIJK__Field__template_1ac37036951f85d1f5aa871f6192e0199a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="72" refid="classIJK__Field__template_1ae9474fc02c5bffb6721e9871dd73ee3f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="73" refid="classIJK__Field__template_1a9bd7082f55e8b5edf784afcae8bcda13" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="74" refid="classIJK__Field__template_1a124d889a52a0ca7baff9d862b26c0e5a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shear_BC_helpler_.prepare_interpolation_for_shear_periodicity((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>round((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>((double)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>isz);</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++)</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmin=<sp/>0.;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmax=<sp/>0.;</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>interpolation_for_shear_periodicity_I_sig_kappa(j<sp/>+<sp/>js,<sp/>k+2-nb_ghost,<sp/>k+2-nb_ghost,<sp/>interpIsigkappazmin,<sp/>interpIsigkappazmax);</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(i<sp/>+<sp/>ir<sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k<sp/>+<sp/>kr)]<sp/>=<sp/>interpolation_for_shear_periodicity_IJK_Field(j<sp/>+<sp/>js,<sp/>k<sp/>+<sp/>ks)<sp/>+<sp/>interpIsigkappazmax-(_TYPE_)<sp/>shear_BC_helpler_.I_sig_kappa_zmin_(i+is<sp/>,<sp/>j+js<sp/>,<sp/>k+2-nb_ghost);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>physical<sp/>properties<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>(zmax)--&gt;<sp/>ghost<sp/>value<sp/>reconstructed<sp/>from<sp/>phase<sp/>indicator<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==2<sp/>&amp;&amp;<sp/>offset<sp/>&lt;0.)</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="90" refid="classIJK__Field__template_1aa37a9dae1bd207f7f407d8e03be1b6ec" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++)</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template" kindref="compound">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(i<sp/>+<sp/>ir<sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k<sp/>+<sp/>kr)]=(_TYPE_)<sp/>shear_BC_helpler_.indicatrice_ghost_zmax_(i<sp/>+<sp/>ir<sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k+2)*(_TYPE_)shear_BC_helpler_.Phi_ppty_l_+((_TYPE_)1.-(_TYPE_)<sp/>shear_BC_helpler_.indicatrice_ghost_zmax_(i<sp/>+<sp/>ir<sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k+2))*(_TYPE_)shear_BC_helpler_.Phi_ppty_v_;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>physical<sp/>properties<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>(zmin)--&gt;<sp/>ghost<sp/>value<sp/>reconstructed<sp/>from<sp/>phase<sp/>indicator<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==2<sp/>&amp;&amp;<sp/>offset<sp/>&gt;0.)</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++)</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template" kindref="compound">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(i<sp/>+<sp/>ir<sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k<sp/>+<sp/>kr)]=(_TYPE_)<sp/>shear_BC_helpler_.indicatrice_ghost_zmin_(i<sp/>+<sp/>ir<sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k+2-nb_ghost)*(_TYPE_)shear_BC_helpler_.Phi_ppty_l_+((_TYPE_)1.-(_TYPE_)<sp/>shear_BC_helpler_.indicatrice_ghost_zmin_(i<sp/>+<sp/>ir<sp/><sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k+2-nb_ghost))*(_TYPE_)shear_BC_helpler_.Phi_ppty_v_;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>all<sp/>other<sp/>variable<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>--&gt;<sp/>interpolation<sp/>+<sp/>jump<sp/>at<sp/>the<sp/>z-boundary<sp/>for<sp/>velocity<sp/>field</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shear_BC_helpler_.prepare_interpolation_for_shear_periodicity((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>round((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>((double)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>isz);</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++)</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template" kindref="compound">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(i<sp/>+<sp/>ir<sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k<sp/>+<sp/>kr)]<sp/>=<sp/>interpolation_for_shear_periodicity_IJK_Field(j<sp/>+<sp/>js,<sp/>k<sp/>+<sp/>ks)<sp/>+<sp/>(_TYPE_)<sp/>jump_i<sp/>;</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>data_size<sp/>=<sp/>isz<sp/>*<sp/>jsz<sp/>*<sp/>ksz;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>data_size_other_buf<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>type_size<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(_TYPE_);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>double_size<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(double);</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>int_size<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(int);</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>*send_buffer<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>*recv_buffer<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>*send_buffer_offset<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>*recv_buffer_offset<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*send_buffer_nb_ghost<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*recv_buffer_nb_ghost<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pe_send_<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>send_buffer<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>_TYPE_[data_size];</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>*buf<sp/>=<sp/>send_buffer;</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>send_buffer_offset<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal">[data_size_other_buf];</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>*buf_offset<sp/>=<sp/>send_buffer_offset;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>send_buffer_nb_ghost<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">[data_size_other_buf];</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*buf_nb_ghost<sp/>=<sp/>send_buffer_nb_ghost;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>*buf_offset=offset;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>*buf_nb_ghost=nb_ghost;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>classical<sp/>variable<sp/>--&gt;<sp/>just<sp/>a<sp/>copy</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(offset==0.)</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++,<sp/>buf++)</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*buf=<sp/><ref refid="classIJK__Field__local__template" kindref="compound">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::operator</ref>()(i<sp/>+<sp/>is,<sp/>j<sp/>+<sp/>js,<sp/>k<sp/>+<sp/>ks);</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>pressure<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>(zmax)--&gt;<sp/>ghost<sp/>value<sp/>reconstructed<sp/>from<sp/>Isigkappa<sp/>and<sp/>pressure<sp/>interpolation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==1<sp/>&amp;&amp;<sp/>offset<sp/>&lt;0.)</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shear_BC_helpler_.prepare_interpolation_for_shear_periodicity((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>round((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>((double)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>isz);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++,<sp/>buf++)</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmin=<sp/>0.;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmax=<sp/>0.;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>interpolation_for_shear_periodicity_I_sig_kappa(j<sp/>+<sp/>js,<sp/>k+2,<sp/>k+2,<sp/>interpIsigkappazmin,<sp/>interpIsigkappazmax);</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*buf<sp/>=<sp/>interpolation_for_shear_periodicity_IJK_Field(j<sp/>+<sp/>js,<sp/>k<sp/>+<sp/>ks)<sp/>+<sp/>interpIsigkappazmin;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>pressure<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>(zmin)--&gt;<sp/>ghost<sp/>value<sp/>reconstructed<sp/>from<sp/>Isigkappa<sp/>and<sp/>pressure<sp/>interpolation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==1<sp/>&amp;&amp;<sp/>offset<sp/>&gt;0.)</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shear_BC_helpler_.prepare_interpolation_for_shear_periodicity((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>round((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>isz);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++,<sp/>buf++)</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmin=<sp/>0.;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmax=<sp/>0.;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>interpolation_for_shear_periodicity_I_sig_kappa(j<sp/>+<sp/>js,<sp/>k+2-nb_ghost,<sp/>k+2-nb_ghost,<sp/>interpIsigkappazmin,<sp/>interpIsigkappazmax);</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*buf<sp/>=<sp/>interpolation_for_shear_periodicity_IJK_Field(j<sp/>+<sp/>js,<sp/>k<sp/>+<sp/>ks)<sp/>+<sp/>interpIsigkappazmax;</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>physical<sp/>properties<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>--&gt;<sp/>ghost<sp/>value<sp/>reconstructed<sp/>from<sp/>phase<sp/>indicator<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==2)</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++,<sp/>buf++)</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*buf=<sp/>(_TYPE_)<sp/>0.;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>all<sp/>other<sp/>variable<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>--&gt;<sp/>interpolation<sp/>+<sp/>jump<sp/>at<sp/>the<sp/>z-boundary<sp/>for<sp/>velocity<sp/>field</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shear_BC_helpler_.prepare_interpolation_for_shear_periodicity((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>round((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>i<sp/>+<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>is<sp/>+<sp/><sp/>offset),<sp/>isz);</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++,<sp/>buf++)</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*buf=<sp/>interpolation_for_shear_periodicity_IJK_Field(j<sp/>+<sp/>js,<sp/>k<sp/>+<sp/>ks)<sp/>+<sp/>(_TYPE_)<sp/>jump_i;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="200"><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pe_recv_<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>recv_buffer<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>_TYPE_[data_size];</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>recv_buffer_offset<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal">[data_size_other_buf];</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>recv_buffer_nb_ghost<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">[data_size_other_buf];</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/>::envoyer_recevoir(send_buffer,<sp/>data_size<sp/>*<sp/>type_size,<sp/>pe_send_,<sp/>recv_buffer,<sp/>data_size<sp/>*<sp/>type_size,<sp/>pe_recv_);</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/>::envoyer_recevoir(send_buffer_offset,<sp/>data_size_other_buf<sp/>*<sp/>double_size,<sp/>pe_send_,<sp/>recv_buffer_offset,<sp/>data_size_other_buf<sp/>*<sp/>double_size,<sp/>pe_recv_);</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/>::envoyer_recevoir(send_buffer_nb_ghost,<sp/>data_size_other_buf<sp/>*<sp/>int_size,<sp/>pe_send_,<sp/>recv_buffer_nb_ghost,<sp/>data_size_other_buf<sp/>*<sp/>int_size,<sp/>pe_recv_);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pe_recv_<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>*buf<sp/>=<sp/>recv_buffer;</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>*buf_offset<sp/>=<sp/>recv_buffer_offset;</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*buf_nb_ghost=<sp/>recv_buffer_nb_ghost;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>*dest<sp/>=<sp/><ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::data</ref>().addr();</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>classical<sp/>variable<sp/>--&gt;<sp/>just<sp/>a<sp/>copy</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*buf_offset<sp/>==<sp/>0.)</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++,<sp/>buf++)</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template" kindref="compound">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(ir<sp/>+<sp/>i,<sp/>jr<sp/>+<sp/>j,<sp/>kr<sp/>+<sp/>k)]<sp/>=<sp/>*buf;</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>pressure<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>(zmax)--&gt;<sp/>ghost<sp/>value<sp/>reconstructed<sp/>from<sp/>Isigkappa<sp/>and<sp/>pressure<sp/>interpolation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==1<sp/>&amp;&amp;<sp/>*buf_offset<sp/>&lt;0.)</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++,<sp/>buf++)</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(i<sp/>+<sp/>ir<sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k<sp/>+<sp/>kr)]<sp/>=<sp/>*buf<sp/>-<sp/>(_TYPE_)<sp/>shear_BC_helpler_.I_sig_kappa_zmax_(i+is<sp/>,<sp/>j+js<sp/>,<sp/>k+2);</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>pressure<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>(zmin)--&gt;<sp/>ghost<sp/>value<sp/>reconstructed<sp/>from<sp/>Isigkappa<sp/>and<sp/>pressure<sp/>interpolation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==1<sp/>&amp;&amp;<sp/>*buf_offset<sp/>&gt;0.)</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++,<sp/>buf++)</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(i<sp/>+<sp/>ir<sp/>,<sp/>j<sp/>+<sp/>jr<sp/>,<sp/>k<sp/>+<sp/>kr)]<sp/>=<sp/>*buf<sp/>-<sp/>(_TYPE_)<sp/>shear_BC_helpler_.I_sig_kappa_zmin_(i+is<sp/>,<sp/>j+js<sp/>,<sp/>k+2-nb_ghost);</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>physical<sp/>properties<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>(zmax)<sp/>--&gt;<sp/>ghost<sp/>value<sp/>reconstructed<sp/>from<sp/>phase<sp/>indicator<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==2<sp/>&amp;&amp;<sp/>*buf_offset<sp/>&lt;0.)</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++,<sp/>buf++)</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template" kindref="compound">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(ir<sp/>+<sp/>i,<sp/>jr<sp/>+<sp/>j,<sp/>kr<sp/>+<sp/>k)]=(_TYPE_)<sp/>shear_BC_helpler_.indicatrice_ghost_zmax_(ir<sp/>+<sp/>i<sp/><sp/>,<sp/>jr<sp/>+<sp/>j<sp/><sp/>,<sp/>k+2)*(_TYPE_)shear_BC_helpler_.Phi_ppty_l_+((_TYPE_)1.-(_TYPE_)<sp/>shear_BC_helpler_.indicatrice_ghost_zmax_(ir<sp/>+<sp/>i<sp/><sp/>,<sp/>jr<sp/>+<sp/>j<sp/><sp/>,<sp/>k+2))*(_TYPE_)shear_BC_helpler_.Phi_ppty_v_;</highlight></codeline>
<codeline lineno="253"><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>physical<sp/>properties<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>(zmin)<sp/>--&gt;<sp/>ghost<sp/>value<sp/>reconstructed<sp/>from<sp/>phase<sp/>indicator<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==2<sp/>&amp;&amp;<sp/>*buf_offset<sp/>&gt;0.)</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++,<sp/>buf++)</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template" kindref="compound">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(ir<sp/>+<sp/>i,<sp/>jr<sp/>+<sp/>j,<sp/>kr<sp/>+<sp/>k)]=(_TYPE_)<sp/>shear_BC_helpler_.indicatrice_ghost_zmin_(ir<sp/>+<sp/>i<sp/><sp/>,<sp/>jr<sp/>+<sp/>j<sp/><sp/>,<sp/>k+2-*buf_nb_ghost)*(_TYPE_)shear_BC_helpler_.Phi_ppty_l_+((_TYPE_)1.-(_TYPE_)<sp/>shear_BC_helpler_.indicatrice_ghost_zmin_(ir<sp/>+<sp/>i<sp/><sp/>,<sp/>jr<sp/>+<sp/>j<sp/><sp/>,<sp/>k+2-*buf_nb_ghost))*(_TYPE_)shear_BC_helpler_.Phi_ppty_v_;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>all<sp/>other<sp/>variable<sp/>in<sp/>case<sp/>of<sp/>shear<sp/>periodicity<sp/>--&gt;<sp/>interpolation<sp/>+<sp/>jump<sp/>at<sp/>the<sp/>z-boundary<sp/>for<sp/>velocity<sp/>field</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>isz;<sp/>i++)</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>ksz;<sp/>k++)</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jsz;<sp/>j++,<sp/>buf++)</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template" kindref="compound">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(ir<sp/>+<sp/>i,<sp/>jr<sp/>+<sp/>j,<sp/>kr<sp/>+<sp/>k)]<sp/>=<sp/>*buf;</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="272"><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal">[]<sp/>send_buffer;</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal">[]<sp/>recv_buffer;</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal">[]<sp/>send_buffer_offset;</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal">[]<sp/>recv_buffer_offset;</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal">[]<sp/>send_buffer_nb_ghost;</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal">[]<sp/>recv_buffer_nb_ghost;</highlight></codeline>
<codeline lineno="281"><highlight class="normal">}</highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight><highlight class="comment"></highlight></codeline>
<codeline lineno="283"><highlight class="comment">/*!<sp/>@brief<sp/>Exchange<sp/>data<sp/>over<sp/>&quot;ghost&quot;<sp/>number<sp/>of<sp/>cells.</highlight></codeline>
<codeline lineno="284"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="285"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="287" refid="classIJK__Field__template_1a34bf4952e7eeaf178687a1137f9bab1c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template_1a34bf4952e7eeaf178687a1137f9bab1c" kindref="member">IJK_Field_template&lt;_TYPE_, _TYPE_ARRAY_&gt;::echange_espace_virtuel</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>le_ghost)</highlight></codeline>
<codeline lineno="288"><highlight class="normal">{</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/>statistics().<ref refid="classPerf__counters_1a8234efa62abcd428fe3df51699090290" kindref="member">begin_count</ref>(STD_COUNTERS::virtual_swap);</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/>assert(le_ghost<sp/>&lt;=<sp/>(<ref refid="classIJK__Field__local__template" kindref="compound">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::ghost</ref>()));</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classDomaine__IJK" kindref="compound">Domaine_IJK</ref>&amp;<sp/>dom<sp/>=<sp/>domaine_ref_.valeur();</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pe_imin_<sp/>=<sp/>dom.<ref refid="classDomaine__IJK_1a01a95c214ee3c7463512142922bfd33d" kindref="member">get_neighbour_processor</ref>(0,<sp/>0);</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pe_imax_<sp/>=<sp/>dom.<ref refid="classDomaine__IJK_1a01a95c214ee3c7463512142922bfd33d" kindref="member">get_neighbour_processor</ref>(1,<sp/>0);</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pe_jmin_<sp/>=<sp/>dom.<ref refid="classDomaine__IJK_1a01a95c214ee3c7463512142922bfd33d" kindref="member">get_neighbour_processor</ref>(0,<sp/>1);</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pe_jmax_<sp/>=<sp/>dom.<ref refid="classDomaine__IJK_1a01a95c214ee3c7463512142922bfd33d" kindref="member">get_neighbour_processor</ref>(1,<sp/>1);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pe_kmin_<sp/>=<sp/>dom.<ref refid="classDomaine__IJK_1a01a95c214ee3c7463512142922bfd33d" kindref="member">get_neighbour_processor</ref>(0,<sp/>2);</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pe_kmax_<sp/>=<sp/>dom.<ref refid="classDomaine__IJK_1a01a95c214ee3c7463512142922bfd33d" kindref="member">get_neighbour_processor</ref>(1,<sp/>2);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>z_index<sp/>=<sp/>dom.<ref refid="classDomaine__IJK_1ae9a749a8e6dab3f6919ad530645f0040" kindref="member">get_local_slice_index</ref>(2);</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>z_index_min<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>z_index_max<sp/>=<sp/>dom.<ref refid="classDomaine__IJK_1a521d67a880bae8475177c3996470c7ae" kindref="member">get_nprocessor_per_direction</ref>(2)<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nii<sp/>=<sp/><ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::ni</ref>();</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>njj<sp/>=<sp/><ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::nj</ref>();</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nkk<sp/>=<sp/><ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::nk</ref>();</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>calculation<sp/>of<sp/>the<sp/>offset<sp/>due<sp/>to<sp/>shear<sp/>periodicity<sp/>between<sp/>zmin<sp/>and<sp/>zmax</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>offset_i<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIJK__Shear__Periodic__helpler_1acf5f2c5df0f4172bbc1090742ffee789" kindref="member">IJK_Shear_Periodic_helpler::defilement_</ref><sp/>==<sp/>1)</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>Lx<sp/>=<sp/><sp/>dom.<ref refid="classDomaine__IJK_1a50640bbbb1a10c2fd7da596c17d2b7d5" kindref="member">get_domain_length</ref>(0);</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classIJK__Shear__Periodic__helpler_1a080dec14e05238f16c9baa65c532ed03" kindref="member">IJK_Shear_Periodic_helpler::Lx_for_shear_perio</ref><sp/>=<sp/>Lx;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>DX<sp/>=<sp/>Lx/nii<sp/>;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>Shear_x_time<sp/>=<sp/><ref refid="classIJK__Shear__Periodic__helpler_1ab033cf6ae610035cbdef879dd1dd2556" kindref="member">IJK_Shear_Periodic_helpler::shear_x_time_</ref>;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>offset_i<sp/>=<sp/>Shear_x_time/DX;</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/>exchange_data(pe_imin_,<sp/>0,<sp/>0,<sp/>0,<sp/>pe_imax_,<sp/>nii,<sp/>0,<sp/>0,<sp/>le_ghost,<sp/>njj,<sp/>nkk);<sp/></highlight><highlight class="comment">/*<sp/>size<sp/>of<sp/>block<sp/>data<sp/>to<sp/>send<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/>exchange_data(pe_imax_,<sp/>nii<sp/>-<sp/>le_ghost,<sp/>0,<sp/>0,<sp/>pe_imin_,<sp/>-le_ghost,<sp/>0,<sp/>0,<sp/>le_ghost,<sp/>njj,<sp/>nkk);</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/>exchange_data(pe_jmin_,<sp/>0,<sp/>0,<sp/>0,<sp/>pe_jmax_,<sp/>0,<sp/>njj,<sp/>0,<sp/>nii,<sp/>le_ghost,<sp/>nkk);</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/>exchange_data(pe_jmax_,<sp/>0,<sp/>njj<sp/>-<sp/>le_ghost,<sp/>0,<sp/>pe_jmin_,<sp/>0,<sp/>-le_ghost,<sp/>0,<sp/>nii,<sp/>le_ghost,<sp/>nkk);</highlight></codeline>
<codeline lineno="320"><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(z_index<sp/>!=<sp/>z_index_min<sp/>and<sp/><ref refid="classIJK__Shear__Periodic__helpler_1acf5f2c5df0f4172bbc1090742ffee789" kindref="member">IJK_Shear_Periodic_helpler::defilement_</ref><sp/>==<sp/>1)</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/>exchange_data(pe_kmin_,<sp/>0,<sp/>0,<sp/>0,<sp/>pe_kmax_,<sp/>0,<sp/>0,<sp/>nkk,<sp/>nii<sp/>,<sp/>njj<sp/>,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/>exchange_data(pe_kmin_,<sp/>0,<sp/>0,<sp/>0,<sp/>pe_kmax_,<sp/>0,<sp/>0,<sp/>nkk,<sp/>nii,<sp/>njj,<sp/>le_ghost,<sp/>-offset_i,<sp/>shear_BC_helpler_.DU_,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(z_index<sp/>!=<sp/>z_index_max<sp/>and<sp/><ref refid="classIJK__Shear__Periodic__helpler_1acf5f2c5df0f4172bbc1090742ffee789" kindref="member">IJK_Shear_Periodic_helpler::defilement_</ref><sp/>==<sp/>1)</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/>exchange_data(pe_kmax_,<sp/>0,<sp/>0,<sp/>nkk<sp/>-<sp/>le_ghost,<sp/>pe_kmin_,<sp/>0,<sp/>0,<sp/>-le_ghost,<sp/>nii,<sp/>njj,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/>exchange_data(pe_kmax_,<sp/>0,<sp/>0,<sp/>nkk<sp/>-<sp/>le_ghost,<sp/>pe_kmin_,<sp/>0,<sp/>0,<sp/>-le_ghost,<sp/>nii,<sp/>njj,<sp/>le_ghost,<sp/>offset_i,<sp/>-shear_BC_helpler_.DU_,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>send<sp/>2D<sp/>ghost<sp/>corner<sp/>value<sp/>(12<sp/>parallepipede)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/>exchange_data(pe_imin_,<sp/>0,<sp/>-le_ghost,<sp/>0<sp/>,<sp/>pe_imax_,<sp/>nii,<sp/>-le_ghost,<sp/>0,<sp/>le_ghost,<sp/>le_ghost,<sp/>nkk);</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/>exchange_data(pe_imin_,<sp/>0,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>0<sp/>,<sp/>pe_imax_,<sp/>nii,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>0,<sp/>le_ghost,<sp/>le_ghost,<sp/>nkk);</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/>exchange_data(pe_imax_,<sp/>nii-le_ghost,<sp/>-le_ghost,<sp/>0<sp/>,<sp/>pe_imin_,<sp/>-le_ghost,<sp/>-le_ghost,<sp/>0,<sp/>le_ghost,<sp/>le_ghost,<sp/>nkk);</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/>exchange_data(pe_imax_,<sp/>nii-le_ghost,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>0<sp/>,<sp/>pe_imin_,<sp/>-le_ghost,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>0,<sp/>le_ghost,<sp/>le_ghost,<sp/>nkk);</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/>exchange_data(pe_jmin_,<sp/>0,<sp/>0,<sp/>-le_ghost,<sp/>pe_jmax_,<sp/>0<sp/>,<sp/>njj,<sp/>-le_ghost,<sp/>nii,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/>exchange_data(pe_jmin_,<sp/>0,<sp/>0,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>pe_jmax_,<sp/>0<sp/>,<sp/>njj,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>nii,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/>exchange_data(pe_jmax_,<sp/>0,<sp/>njj-le_ghost,<sp/>-<sp/>le_ghost,<sp/>pe_jmin_,<sp/>0,<sp/>-le_ghost,<sp/>-le_ghost,<sp/>nii,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/>exchange_data(pe_jmax_,<sp/>0,<sp/>njj-le_ghost,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>pe_jmin_,<sp/>0,<sp/>-le_ghost,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>nii,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/>exchange_data(pe_kmin_,<sp/>-le_ghost,<sp/>0<sp/>,<sp/>0,<sp/>pe_kmax_,<sp/>-le_ghost,<sp/>0,<sp/>nkk,<sp/>le_ghost,<sp/>njj,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/>exchange_data(pe_kmin_,<sp/>nii<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>0<sp/>,<sp/>0,<sp/>pe_kmax_,<sp/>nii<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>0,<sp/>nkk,<sp/>le_ghost,<sp/>njj,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/>exchange_data(pe_kmax_,<sp/>-le_ghost,<sp/>0<sp/>,<sp/>nkk-le_ghost,<sp/>pe_kmin_,<sp/>-le_ghost,<sp/>0,<sp/>-le_ghost,<sp/>le_ghost,<sp/>njj,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/>exchange_data(pe_kmax_,<sp/>nii<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>0<sp/>,<sp/>nkk-le_ghost,<sp/>pe_kmin_,<sp/>nii<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>0,<sp/>-le_ghost,<sp/>le_ghost,<sp/>njj,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="346"><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>send<sp/>3D<sp/>ghost<sp/>corner<sp/>value<sp/>(8<sp/>cubes)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/>exchange_data(pe_imin_,<sp/>0,<sp/>-le_ghost,<sp/>-le_ghost<sp/>,<sp/>pe_imax_,<sp/>nii,<sp/>-le_ghost,<sp/>-le_ghost,<sp/>le_ghost,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/>exchange_data(pe_imin_,<sp/>0,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>-le_ghost<sp/>,<sp/>pe_imax_,<sp/>nii,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>-le_ghost,<sp/>le_ghost,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/>exchange_data(pe_imin_,<sp/>0,<sp/>-le_ghost,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>pe_imax_,<sp/>nii,<sp/>-le_ghost,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>le_ghost,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/>exchange_data(pe_imin_,<sp/>0,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>pe_imax_,<sp/>nii,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>le_ghost,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/>exchange_data(pe_imax_,<sp/>nii-le_ghost,<sp/>-le_ghost,<sp/>-le_ghost,<sp/>pe_imin_,<sp/>-le_ghost,<sp/>-le_ghost,<sp/>-le_ghost<sp/>,<sp/>le_ghost,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/>exchange_data(pe_imax_,<sp/>nii-le_ghost,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>-le_ghost,<sp/>pe_imin_,<sp/>-le_ghost,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>-le_ghost<sp/>,<sp/>le_ghost,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/>exchange_data(pe_imax_,<sp/>nii-le_ghost,<sp/>-le_ghost,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>pe_imin_,<sp/>-le_ghost,<sp/>-le_ghost,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>le_ghost,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/>exchange_data(pe_imax_,<sp/>nii-le_ghost,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>pe_imin_,<sp/>-le_ghost,<sp/>njj<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>nkk<sp/><sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>le_ghost,<sp/>le_ghost,<sp/>le_ghost);</highlight></codeline>
<codeline lineno="356"><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/>statistics().<ref refid="classPerf__counters_1ad528e593c4ea8c18b317fef30632b053" kindref="member">end_count</ref>(STD_COUNTERS::virtual_swap);</highlight></codeline>
<codeline lineno="358"><highlight class="normal">}</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="361" refid="classIJK__Field__template_1ac37036951f85d1f5aa871f6192e0199a" refkind="member"><highlight class="normal">_TYPE_<sp/><ref refid="classIJK__Field__template_1ac37036951f85d1f5aa871f6192e0199a" kindref="member">IJK_Field_template&lt;_TYPE_, _TYPE_ARRAY_&gt;::interpolation_for_shear_periodicity_IJK_Field</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>send_j,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>send_k)</highlight></codeline>
<codeline lineno="362"><highlight class="normal">{</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>execute<sp/>the<sp/>shear-periodicity<sp/>interpolation.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>prepare_interpolation_for_shear_periodicity<sp/>has<sp/>to<sp/>be<sp/>called<sp/>before</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>resu<sp/>=<sp/>(_TYPE_)0.<sp/>;</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nb_points<sp/>=<sp/>shear_BC_helpler_.order_interpolation_+1;</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pt<sp/>=<sp/>0;<sp/>pt<sp/>&lt;<sp/>nb_points<sp/>;<sp/>pt++)</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>resu<sp/>+=<sp/>(_TYPE_)(shear_BC_helpler_.res_[pt]/shear_BC_helpler_.denum_[pt]*<ref refid="classIJK__Field__local__template" kindref="compound">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::operator</ref>()(shear_BC_helpler_.send_i_real_[pt],<sp/>send_j,<sp/>send_k));</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>resu;</highlight></codeline>
<codeline lineno="373"><highlight class="normal">}</highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="375" refid="classIJK__Field__template_1ae9474fc02c5bffb6721e9871dd73ee3f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template_1ae9474fc02c5bffb6721e9871dd73ee3f" kindref="member">IJK_Field_template&lt;_TYPE_, _TYPE_ARRAY_&gt;::interpolation_for_shear_periodicity_I_sig_kappa</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>send_j,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>send_k_zmin,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>send_k_zmax,<sp/>_TYPE_<sp/>Isigkappazmin,<sp/>_TYPE_<sp/>Isigkappazmax)</highlight></codeline>
<codeline lineno="376"><highlight class="normal">{</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>execute<sp/>the<sp/>shear-periodicity<sp/>interpolation.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>prepare_interpolation_for_shear_periodicity<sp/>has<sp/>to<sp/>be<sp/>called<sp/>before</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/>Isigkappazmin<sp/>=<sp/>(_TYPE_)0.<sp/>;</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/>Isigkappazmax<sp/>=<sp/>(_TYPE_)0.<sp/>;</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nb_points<sp/>=<sp/>shear_BC_helpler_.order_interpolation_+1;</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pt<sp/>=<sp/>0;<sp/>pt<sp/>&lt;<sp/>nb_points<sp/>;<sp/>pt++)</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Isigkappazmin<sp/>+=<sp/>(_TYPE_)(shear_BC_helpler_.res_[pt]/shear_BC_helpler_.denum_[pt]*shear_BC_helpler_.I_sig_kappa_zmin_(shear_BC_helpler_.send_i_real_[pt],<sp/>send_j,<sp/>send_k_zmin));</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Isigkappazmax<sp/>+=<sp/>(_TYPE_)(shear_BC_helpler_.res_[pt]/shear_BC_helpler_.denum_[pt]*shear_BC_helpler_.I_sig_kappa_zmax_(shear_BC_helpler_.send_i_real_[pt],<sp/>send_j,<sp/>send_k_zmax));</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="389"><highlight class="normal">}</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="393" refid="classIJK__Field__template_1a9bd7082f55e8b5edf784afcae8bcda13" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template_1a9bd7082f55e8b5edf784afcae8bcda13" kindref="member">IJK_Field_template&lt;_TYPE_, _TYPE_ARRAY_&gt;::redistribute_with_shear_domain_ft</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_double</ref>&amp;<sp/>input,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>DU_perio,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ft_extension)</highlight></codeline>
<codeline lineno="394"><highlight class="normal">{</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>To<sp/>shift<sp/>the<sp/>velocity<sp/>field<sp/>in<sp/>FT<sp/>domain<sp/>after<sp/>redistribute<sp/>operator<sp/>from<sp/>NS<sp/>domain</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>According<sp/>to<sp/>the<sp/>shear<sp/>periodicity<sp/>condition</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>*dest<sp/>=<sp/><ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::data</ref>().addr();</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><ref refid="classDomaine__IJK" kindref="compound">Domaine_IJK</ref><sp/>splitting_ns<sp/>=<sp/>input.<ref refid="classIJK__Field__template_1a6ddbb2e928ae8382ee1c398f5876fead" kindref="member">get_domaine</ref>();</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><ref refid="classDomaine__IJK" kindref="compound">Domaine_IJK</ref>&amp;<sp/>splitting_ft<sp/>=<sp/>domaine_ref_.valeur();</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>Lx<sp/>=<sp/><sp/>splitting_ns.<ref refid="classDomaine__IJK_1a50640bbbb1a10c2fd7da596c17d2b7d5" kindref="member">get_domain_length</ref>(0);</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ni<sp/>=<sp/>input.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>();</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>DX<sp/>=<sp/>Lx/ni<sp/>;</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nii<sp/>=<sp/><ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::ni</ref>();</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>njj<sp/>=<sp/><ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::nj</ref>();</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nkk<sp/>=<sp/><ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::nk</ref>();</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>last_global_k<sp/>=<sp/>splitting_ns.<ref refid="classDomaine__IJK_1ab4b922b8cf6bae26173fa4ea35c5a2ea" kindref="member">get_nb_items_global</ref>(<ref refid="classDomaine__IJK_1af42f29bc11c3d6e985da2a908f6e8ba3a4a01cd61239708e0c20e9fbedfa52eb6" kindref="member">Domaine_IJK::ELEM</ref>,<sp/>2)-1;</highlight></codeline>
<codeline lineno="408"><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref><sp/>output_tmp;</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/>output_tmp.<ref refid="classTRUSTArray_1ad1bd36a32ef2d67b0a3695b5d97ac0ab" kindref="member">resize_array</ref>(nii);</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>nkk;<sp/>k++<sp/>)</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k_reel<sp/>=<sp/>k<sp/>+<sp/>splitting_ft.<ref refid="classDomaine__IJK_1a017a270a5516eb0f31b9b240b290bcfd" kindref="member">get_offset_local</ref>(2)<sp/>-<sp/>ft_extension;</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(k_reel&gt;=0<sp/>&amp;&amp;<sp/>k_reel&lt;=<sp/>last_global_k)</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>njj;<sp/>j++<sp/>)</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>nii;<sp/>i++<sp/>)</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(k_reel&lt;0)</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>istmp<sp/>=<sp/>i+<ref refid="classIJK__Shear__Periodic__helpler_1ab033cf6ae610035cbdef879dd1dd2556" kindref="member">IJK_Shear_Periodic_helpler::shear_x_time_</ref>/DX;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shear_BC_helpler_.prepare_interpolation_for_shear_periodicity((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>round(istmp),<sp/>istmp,<sp/>ni);</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output_tmp[i]=interpolation_for_shear_periodicity_IJK_Field(j,<sp/>k)-DU_perio;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(k_reel&gt;last_global_k)</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>istmp<sp/>=<sp/>i-<ref refid="classIJK__Shear__Periodic__helpler_1ab033cf6ae610035cbdef879dd1dd2556" kindref="member">IJK_Shear_Periodic_helpler::shear_x_time_</ref>/DX;</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shear_BC_helpler_.prepare_interpolation_for_shear_periodicity((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>round(istmp),<sp/>istmp,<sp/>ni);</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output_tmp[i]=interpolation_for_shear_periodicity_IJK_Field(j,<sp/>k)+DU_perio;</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output_tmp[i]=<ref refid="classIJK__Field__local__template_1afd53b935929ae70388bc3628888dbc17" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::operator()</ref>(i,<sp/>j,<sp/>k);</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>nii;<sp/>i++<sp/>)</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dest[<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::linear_index</ref>(i,<sp/>j,<sp/>k)]=output_tmp[i];</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="445"><highlight class="normal">}</highlight></codeline>
<codeline lineno="446"><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"></highlight><highlight class="comment">//<sp/>ajout<sp/>au<sp/>second<sp/>membre<sp/>de<sp/>pressure_rhs<sp/>un<sp/>terme<sp/>correctif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight><highlight class="comment">//<sp/>ce<sp/>terme<sp/>compense<sp/>l<sp/>erreur<sp/>commise<sp/>par<sp/>l<sp/>interpolation<sp/>sur<sp/>le<sp/>bord<sp/>perio<sp/>z<sp/>de<sp/>la<sp/>pression<sp/>monofluide<sp/>dans<sp/>le<sp/>cas<sp/>de<sp/>conditions<sp/>shear<sp/>periodique</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="452" refid="classIJK__Field__template_1a124d889a52a0ca7baff9d862b26c0e5a" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template_1a124d889a52a0ca7baff9d862b26c0e5a" kindref="member">IJK_Field_template&lt;_TYPE_, _TYPE_ARRAY_&gt;::ajouter_second_membre_shear_perio</ref>(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_double</ref>&amp;<sp/>resu)</highlight></codeline>
<codeline lineno="453"><highlight class="normal">{</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.monofluide_variable_==1)</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classDomaine__IJK" kindref="compound">Domaine_IJK</ref>&amp;<sp/>geom<sp/>=<sp/>domaine_ref_.valeur();</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ni<sp/>=<sp/><ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::ni</ref>();</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nj<sp/>=<sp/><ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::nj</ref>();</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nk<sp/>=<sp/><ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">IJK_Field_local_template&lt;_TYPE_,_TYPE_ARRAY_&gt;::nk</ref>();</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>dxk<sp/>=<sp/>geom.<ref refid="classDomaine__IJK_1a848dec542ca157d758301b7bfb926d96" kindref="member">get_constant_delta</ref>(2);</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>dxj<sp/>=<sp/>geom.<ref refid="classDomaine__IJK_1a848dec542ca157d758301b7bfb926d96" kindref="member">get_constant_delta</ref>(1);</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>dxi<sp/>=<sp/>geom.<ref refid="classDomaine__IJK_1a848dec542ca157d758301b7bfb926d96" kindref="member">get_constant_delta</ref>(0);</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>Shear_x_time<sp/>=<sp/><ref refid="classIJK__Shear__Periodic__helpler_1ab033cf6ae610035cbdef879dd1dd2556" kindref="member">IJK_Shear_Periodic_helpler::shear_x_time_</ref>;</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>offset<sp/>=<sp/>Shear_x_time/dxi;</highlight></codeline>
<codeline lineno="465"><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Les<sp/>coeffs<sp/>de<sp/>la<sp/>matrice<sp/>de<sp/>pression<sp/>sont<sp/>multiplies<sp/>par<sp/>V/h^2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ici<sp/>on<sp/>parle<sp/>d&apos;un<sp/>voisin<sp/>sur<sp/>dz<sp/>donc<sp/>h<sp/>=<sp/>dz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>coef<sp/>=<sp/>dx*dy*dz/dz*dz<sp/>=<sp/>dx*dy/dz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>on<sp/>ajoute<sp/>le<sp/>terme<sp/>a<sp/>pressure_rhs<sp/>juste<sp/>avant<sp/>l&apos;appel<sp/>du<sp/>solveur<sp/>de<sp/>pression</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>pressure_rhs<sp/>a<sp/>deja<sp/>integre<sp/>d_velocity<sp/>sur<sp/>le<sp/>volume<sp/>et<sp/>divise<sp/>par<sp/>rho</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Le<sp/>coeff<sp/>a<sp/>appliquer<sp/>est<sp/>donc<sp/>dx*dy/dz/rho</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>coeff_matrice<sp/>=<sp/>dxi<sp/>*<sp/>dxj<sp/>/<sp/>dxk;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>last_global_k<sp/>=<sp/>geom.<ref refid="classDomaine__IJK_1ab4b922b8cf6bae26173fa4ea35c5a2ea" kindref="member">get_nb_items_global</ref>(<ref refid="classDomaine__IJK_1af42f29bc11c3d6e985da2a908f6e8ba3a4a01cd61239708e0c20e9fbedfa52eb6" kindref="member">Domaine_IJK::ELEM</ref>,<sp/>2);</highlight></codeline>
<codeline lineno="475"><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>EQUIVALENCE<sp/>GHOST_MIN_MAX<sp/>ARRAY<sp/>AVEC<sp/>INDICE<sp/>Z<sp/>REEL<sp/>POUR<sp/>SPLITTING_NS_</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>I_sigma_kappa_ghost_zmin_[0]<sp/>--&gt;<sp/>-ghost<sp/>(derniere<sp/>maille<sp/>ghost)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>I_sigma_kappa_ghost_zmin_[ghost-1]<sp/>--&gt;<sp/>-1<sp/>(premiere<sp/>maille<sp/>ghost)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>I_sigma_kappa_ghost_zmin_[ghost]<sp/>--&gt;<sp/>0<sp/>(premiere<sp/>maille<sp/>reelle)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>I_sigma_kappa_ghost_zmin_[2*ghost]<sp/>--&gt;<sp/>+ghost<sp/>(derniere<sp/>maille<sp/>reelle)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>I_sigma_kappa_ghost_zmax_[0]<sp/>--&gt;<sp/>nk-1-ghost(derniere<sp/>maille<sp/>reelle)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>I_sigma_kappa_ghost_zmax_[ghost]<sp/>--&gt;<sp/>nk-1<sp/>(premiere<sp/>maille<sp/>reelle)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>I_sigma_kappa_ghost_zmax_[ghost+1]<sp/>--&gt;<sp/>nk<sp/>(premiere<sp/>maille<sp/>ghost)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>I_sigma_kappa_ghost_zmax_[2*ghost]<sp/>--&gt;<sp/>nk-1+ghost<sp/>(derniere<sp/>maille<sp/>ghost)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0<sp/>;<sp/>j<sp/>&lt;<sp/>nj;<sp/>j++)</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0<sp/>;<sp/>i<sp/>&lt;<sp/>ni;<sp/>i++)</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shear_BC_helpler_.prepare_interpolation_for_shear_periodicity((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>round((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>i<sp/>+<sp/><sp/>offset),<sp/>((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/>i<sp/>+<sp/><sp/>offset),<sp/>ni);</highlight></codeline>
<codeline lineno="491"><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>k=0<sp/>--&gt;<sp/>pression<sp/>voisine<sp/>problematique<sp/>en<sp/>k=-1<sp/>(qui<sp/>renvoie<sp/>a<sp/>une<sp/>interpolation<sp/>sur<sp/>k=nk-1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>I_sigma_kappa<sp/>interpole<sp/>en<sp/>k=nk-1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>I_sigma_kappa<sp/>reel<sp/>en<sp/>k=-1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>k=0<sp/>(z_index_min<sp/>--&gt;<sp/>+<sp/>offset)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(geom.<ref refid="classDomaine__IJK_1a017a270a5516eb0f31b9b240b290bcfd" kindref="member">get_offset_local</ref>(2)==0)</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>rho_minus_1<sp/>=<sp/>shear_BC_helpler_.Phi_ppty_l_*shear_BC_helpler_.indicatrice_ghost_zmin_(i,j,1)+shear_BC_helpler_.Phi_ppty_v_*(1.-shear_BC_helpler_.indicatrice_ghost_zmin_(i,j,1));</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>rho_0<sp/>=<sp/>shear_BC_helpler_.Phi_ppty_l_*shear_BC_helpler_.indicatrice_ghost_zmin_(i,j,2)+shear_BC_helpler_.Phi_ppty_v_*(1.-shear_BC_helpler_.indicatrice_ghost_zmin_(i,j,2));</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>rho;</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.use_inv_rho_in_pressure_solver_==1.)</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rho<sp/>=2./((1./rho_minus_1)+(1./rho_0));</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rho<sp/>=(rho_minus_1+rho_0)/2.;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmin<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmax<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>interpolation_for_shear_periodicity_I_sig_kappa(j,<sp/>1,<sp/>1,<sp/>interpIsigkappazmin,<sp/>interpIsigkappazmax);</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>erreur<sp/>=<sp/>interpIsigkappazmax-(_TYPE_)shear_BC_helpler_.I_sig_kappa_zmin_(i<sp/>,<sp/>j<sp/>,<sp/>1);</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>resu(i,j,0)+=(coeff_matrice/rho)*erreur;</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="515"><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>k=nk-1<sp/>--&gt;<sp/>pression<sp/>voisine<sp/>problematique<sp/>en<sp/>k=nk<sp/>(qui<sp/>renvoie<sp/>a<sp/>une<sp/>interpolation<sp/>sur<sp/>k=0)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>I_sigma_kappa<sp/>interpole<sp/>en<sp/>k=0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>I_sigma_kappa<sp/>reel<sp/>en<sp/>k=nk</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>k=nk-1<sp/>(z_index_max<sp/>--&gt;<sp/>-<sp/>offset)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(geom.<ref refid="classDomaine__IJK_1a017a270a5516eb0f31b9b240b290bcfd" kindref="member">get_offset_local</ref>(2)+nk==last_global_k)</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>rho_nk_plus_1<sp/>=<sp/>shear_BC_helpler_.Phi_ppty_l_*shear_BC_helpler_.indicatrice_ghost_zmax_(i,j,2)+shear_BC_helpler_.Phi_ppty_v_*(1.-shear_BC_helpler_.indicatrice_ghost_zmax_(i,j,2));</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>rho_nk<sp/>=<sp/>shear_BC_helpler_.Phi_ppty_l_*shear_BC_helpler_.indicatrice_ghost_zmax_(i,j,1)+shear_BC_helpler_.Phi_ppty_v_*(1.-shear_BC_helpler_.indicatrice_ghost_zmax_(i,j,1));</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>rho;</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shear_BC_helpler_.use_inv_rho_in_pressure_solver_==1.)</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rho<sp/>=2./((1./rho_nk_plus_1)+(1./rho_nk));</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rho<sp/>=(rho_nk_plus_1+rho_nk)/2.;</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmin=<sp/>0.;</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>interpIsigkappazmax=<sp/>0.;</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>interpolation_for_shear_periodicity_I_sig_kappa(j,<sp/>2,<sp/>2,<sp/>interpIsigkappazmin,<sp/>interpIsigkappazmax);</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>erreur<sp/>=<sp/>interpIsigkappazmin-(_TYPE_)shear_BC_helpler_.I_sig_kappa_zmax_(i<sp/>,<sp/>j<sp/>,<sp/>2);</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>resu(i,j,nk-1)+=(coeff_matrice/rho)*erreur;</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="542"><highlight class="normal">}</highlight></codeline>
<codeline lineno="543"><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Initializes<sp/>the<sp/>field<sp/>and<sp/>allocates<sp/>memory</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"></highlight><highlight class="comment">//<sp/>geom:<sp/>reference<sp/>to<sp/>the<sp/>geometry<sp/>of<sp/>the<sp/>IJK<sp/>mesh<sp/>and<sp/>how<sp/>the<sp/>mesh<sp/>is<sp/>split<sp/>on<sp/>processors.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>The<sp/>field<sp/>stores<sp/>a<sp/>reference<sp/>to<sp/>this<sp/>Domaine_IJK<sp/>object<sp/>so<sp/>do<sp/>not<sp/>delete<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"></highlight><highlight class="comment">//<sp/>loc:<sp/>localisation<sp/>of<sp/>the<sp/>field<sp/>(elements,<sp/>nodes,<sp/>faces<sp/>in<sp/>direction<sp/>i,<sp/>j,<sp/>or<sp/>k)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>The<sp/>number<sp/>of<sp/>&quot;real&quot;<sp/>items<sp/>in<sp/>each<sp/>direction<sp/>(returned<sp/>by<sp/>the<sp/>ni(),<sp/>nj()<sp/>or<sp/>nk()<sp/>method)<sp/>is<sp/>obtained<sp/>from</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>the<sp/>Domaine_IJK<sp/>object.<sp/>Warning:<sp/>on<sp/>a<sp/>processor<sp/>that<sp/>is<sp/>in<sp/>the<sp/>middle<sp/>of<sp/>the<sp/>mesh,<sp/>the<sp/>nodes<sp/>on<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="550"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>right<sp/>of<sp/>the<sp/>rightmost<sp/>real<sp/>element<sp/>are<sp/>not<sp/>real,<sp/>they<sp/>are<sp/>virtual,<sp/>values<sp/>are<sp/>copied<sp/>from<sp/>the<sp/>neigbour</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>processor.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"></highlight><highlight class="comment">//<sp/>ghost_size:<sp/>number<sp/>of<sp/>ghost<sp/>layers<sp/>to<sp/>allocate.<sp/>When<sp/>an<sp/>exchange<sp/>of<sp/>ghost<sp/>cells<sp/>data<sp/>is<sp/>requested,<sp/>a<sp/>smaller</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>number<sp/>of<sp/>layers<sp/>can<sp/>be<sp/>requested<sp/>if<sp/>all<sp/>layers<sp/>are<sp/>not<sp/>needed<sp/>by<sp/>the<sp/>following<sp/>operations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"></highlight><highlight class="comment">//<sp/>additional_k_layers:<sp/>allocates<sp/>more<sp/>layers<sp/>of<sp/>cells<sp/>in<sp/>the<sp/>k<sp/>direction<sp/>for<sp/>use<sp/>with<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>shift_k_origin()<sp/>method<sp/>(optimization<sp/>trick<sp/>used<sp/>by<sp/>the<sp/>temporally<sp/>blocked<sp/>algorithms<sp/>in<sp/>the<sp/>multigrid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>solver</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight><highlight class="comment">//<sp/>nb_compo:<sp/>number<sp/>of<sp/>components<sp/>of<sp/>the<sp/>field.<sp/>Warning:<sp/>you<sp/>cannot<sp/>allocate<sp/>the<sp/>velocity<sp/>field<sp/>at<sp/>faces</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>with<sp/>nb_compo=3:<sp/>numbers<sp/>of<sp/>faces<sp/>in<sp/>each<sp/>direction<sp/>differ.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>Also,<sp/>components<sp/>are<sp/>not<sp/>grouped<sp/>by<sp/>node<sp/>but<sp/>stored<sp/>by<sp/>layers<sp/>in<sp/>k.<sp/>nb_compo&gt;1<sp/>is<sp/>essentially<sp/>used</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>in<sp/>the<sp/>multigrid<sp/>solver<sp/>to<sp/>optimize<sp/>memory<sp/>accesses<sp/>to<sp/>the<sp/>components<sp/>of<sp/>the<sp/>matrix.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="562" refid="classIJK__Field__template_1a9c330f12b41547930db9e6cedb736c8c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template_1a9c330f12b41547930db9e6cedb736c8c" kindref="member">IJK_Field_template&lt;_TYPE_, _TYPE_ARRAY_&gt;::allocate</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classDomaine__IJK" kindref="compound">Domaine_IJK</ref>&amp;<sp/>geom,<sp/><ref refid="classDomaine__IJK_1af42f29bc11c3d6e985da2a908f6e8ba3" kindref="member">Domaine_IJK::Localisation</ref><sp/>loc,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ghost_size,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>additional_k_layers,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ncompo,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/>name)</highlight></codeline>
<codeline lineno="563"><highlight class="normal">{</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/>this-&gt;nommer(name);</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ni_local<sp/>=<sp/>geom.<ref refid="classDomaine__IJK_1a66018a4ea3bfd6da56ec47617d0d4ed7" kindref="member">get_nb_items_local</ref>(loc,<sp/>0);</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nj_local<sp/>=<sp/>geom.<ref refid="classDomaine__IJK_1a66018a4ea3bfd6da56ec47617d0d4ed7" kindref="member">get_nb_items_local</ref>(loc,<sp/>1);</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nk_local<sp/>=<sp/>geom.<ref refid="classDomaine__IJK_1a66018a4ea3bfd6da56ec47617d0d4ed7" kindref="member">get_nb_items_local</ref>(loc,<sp/>2);</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Field__local__template_1a02254e5ea9888a58be24e3424140aa53" kindref="member">IJK_Field_local_template&lt;_TYPE_, _TYPE_ARRAY_&gt;::allocate</ref>(ni_local,<sp/>nj_local,<sp/>nk_local,<sp/>ghost_size,<sp/>additional_k_layers,<sp/>ncompo);</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/>domaine_ref_<sp/>=<sp/>geom;</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/>localisation_<sp/>=<sp/>loc;</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/>alloc_counter_++;</highlight></codeline>
<codeline lineno="572"><highlight class="normal">}</highlight></codeline>
<codeline lineno="573"><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="575" refid="classIJK__Field__template_1a5942d9ff62d57d77a11b0dda5d4e91f5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template_1a5942d9ff62d57d77a11b0dda5d4e91f5" kindref="member">IJK_Field_template&lt;_TYPE_, _TYPE_ARRAY_&gt;::allocate_shear_BC</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>type,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>phy_ppty_v,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>phy_ppty_l,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>use_inv_rho_in_pressure_solver)</highlight></codeline>
<codeline lineno="576"><highlight class="normal">{</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ni_local<sp/>=<sp/>this-&gt;domaine_ref_-&gt;get_nb_items_local(localisation_,<sp/>0);</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nj_local<sp/>=<sp/>this-&gt;domaine_ref_-&gt;get_nb_items_local(localisation_,<sp/>1);</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nk_local<sp/>=<sp/>this-&gt;domaine_ref_-&gt;get_nb_items_local(localisation_,<sp/>2);</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/>shear_BC_helpler_.allocate(ni_local,<sp/><sp/>nj_local,<sp/>nk_local,<sp/><sp/>this-&gt;ghost_size_,<sp/><sp/>this-&gt;nb_compo_,<sp/><sp/>type,<sp/><sp/>phy_ppty_v,<sp/><sp/>phy_ppty_l,<sp/><sp/>use_inv_rho_in_pressure_solver);</highlight></codeline>
<codeline lineno="581"><highlight class="normal">}</highlight></codeline>
<codeline lineno="582"><highlight class="normal"></highlight></codeline>
<codeline lineno="583"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="584" refid="classIJK__Field__template_1acbbc58e449fe4f1b0f1586c280fad825" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template_1acbbc58e449fe4f1b0f1586c280fad825" kindref="member">IJK_Field_template&lt;_TYPE_, _TYPE_ARRAY_&gt;::dumplata_scalar</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*filename,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>step)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="585"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><ref refid="classProcess_1aa9e74a5c06a68ea38298a08ea401e7b1" kindref="member">Process::barrier</ref>();</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><ref refid="classSFichier" kindref="compound">SFichier</ref><sp/>master_file;</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>prefix<sp/>=<sp/><ref refid="classNom" kindref="compound">Nom</ref>(filename)<sp/>+<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;.&quot;</highlight><highlight class="normal">)<sp/>+<sp/><ref refid="classNom" kindref="compound">Nom</ref>(step)<sp/>+<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>fd<sp/>=<sp/>prefix<sp/>+<sp/>this-&gt;le_nom();</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Striped__Writer" kindref="compound">IJK_Striped_Writer</ref><sp/>striped_writer;</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>Size_t<sp/>n<sp/>=<sp/>striped_writer.<ref refid="classIJK__Striped__Writer_1aab381bb0fb3aeaa6b3bdfb5d749315d8" kindref="member">write_data_template</ref>&lt;float,_TYPE_,_TYPE_ARRAY_&gt;(fd,<sp/>*</highlight><highlight class="keyword">this</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classProcess_1acd052b99706c577f8a5b6656217cf4c2" kindref="member">Process::je_suis_maitre</ref>())</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>master_file.<ref refid="classSortie__Fichier__base_1a62e30d92695a25269f12d16948e02af3" kindref="member">ouvrir</ref>(filename,<sp/>ios::app);</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>loc;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(get_localisation()<sp/>==<sp/><ref refid="classDomaine__IJK_1af42f29bc11c3d6e985da2a908f6e8ba3a4a01cd61239708e0c20e9fbedfa52eb6" kindref="member">Domaine_IJK::ELEM</ref>)</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>loc<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;ELEM&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>loc<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SOM&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/>geomname<sp/>=<sp/>get_domaine().<ref refid="classNom_1ae5d7b0dc793b2dcd6f3bdf550cd41da6" kindref="member">le_nom</ref>();</highlight></codeline>
<codeline lineno="601"><highlight class="normal"></highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>path,<sp/>base_name;</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>split_path_filename(fd,<sp/>path,<sp/>base_name);</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>master_file<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Champ<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>this-&gt;le_nom()<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal">&lt;&lt;<sp/>base_name<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>geometrie=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>geomname;</highlight></codeline>
<codeline lineno="605"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>INT_is_64_</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>master_file<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>file_offset=6&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="607"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>master_file<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>size=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>(int)n<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>localisation=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>loc<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>composantes=1&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><ref refid="classProcess_1aa9e74a5c06a68ea38298a08ea401e7b1" kindref="member">Process::barrier</ref>();</highlight></codeline>
<codeline lineno="611"><highlight class="normal">}</highlight></codeline>
<codeline lineno="612"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>IJK_Field_template_TPP_H<sp/>*/</highlight><highlight class="preprocessor"></highlight></codeline>
    </programlisting>
    <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/Kernel/IJK/Champs/IJK_Field_template.tpp"/>
  </compounddef>
</doxygen>
