<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.1" xml:lang="en-US">
  <compounddef id="Solv__Petsc_8h" kind="file" language="C++">
    <compoundname>Solv_Petsc.h</compoundname>
    <includes local="no">petsc_for_kernel.h</includes>
    <includes refid="EChaine_8h" local="no">EChaine.h</includes>
    <includes refid="Nom_8h" local="no">Nom.h</includes>
    <includes refid="Solv__Externe_8h" local="no">Solv_Externe.h</includes>
    <includes refid="ArrOfBit_8h" local="no">ArrOfBit.h</includes>
    <includes refid="PCShell__base_8h" local="no">PCShell_base.h</includes>
    <includes refid="TRUST__Deriv_8h" local="no">TRUST_Deriv.h</includes>
    <includedby refid="Solv__AMG_8h" local="no">Solv_AMG.h</includedby>
    <includedby refid="Solv__AMGX_8h" local="no">Solv_AMGX.h</includedby>
    <includedby refid="Solv__Petsc_8cpp" local="no">Solv_Petsc.cpp</includedby>
    <includedby refid="Solv__Petsc__GPU_8h" local="no">Solv_Petsc_GPU.h</includedby>
    <includedby refid="SETS_8h" local="no">SETS.h</includedby>
    <includedby refid="Assembleur__P__VEFPreP1B_8cpp" local="no">Assembleur_P_VEFPreP1B.cpp</includedby>
    <incdepgraph>
      <node id="1">
        <label>Solv_Petsc.h</label>
        <link refid="Solv__Petsc_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>petsc_for_kernel.h</label>
      </node>
    </incdepgraph>
    <innerclass refid="classoption" prot="public">option</innerclass>
    <innerclass refid="classoption__double" prot="public">option_double</innerclass>
    <innerclass refid="classoption__int" prot="public">option_int</innerclass>
    <innerclass refid="classoption__string" prot="public">option_string</innerclass>
    <innerclass refid="structPCstruct" prot="public">PCstruct</innerclass>
    <innerclass refid="classSolv__Petsc" prot="public">Solv_Petsc</innerclass>
      <sectiondef kind="define">
      <memberdef kind="define" id="Solv__Petsc_8h_1a6781e64c30c60e9d2a75349c3546c14b" prot="public" static="no">
        <name>NB_IT_MAX_DEFINED</name>
        <initializer>10000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/Kernel/Math/SolvSys/Solv_Petsc.h" line="213" column="9" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/Kernel/Math/SolvSys/Solv_Petsc.h" bodystart="213" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="enum">
      <memberdef kind="enum" id="Solv__Petsc_8h_1a5a0a487c7e0e114f4d92a88e2a5808b6" prot="public" static="no" strong="no">
        <type></type>
        <name>solveur_direct_</name>
        <enumvalue id="Solv__Petsc_8h_1a5a0a487c7e0e114f4d92a88e2a5808b6a8fe4a05f1addc1b9a4aae17d7b166646" prot="public">
          <name>no</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="Solv__Petsc_8h_1a5a0a487c7e0e114f4d92a88e2a5808b6a1cb49f862e7fcd552eed7f0145c86db1" prot="public">
          <name>mumps</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="Solv__Petsc_8h_1a5a0a487c7e0e114f4d92a88e2a5808b6ae182fa5e69fe3b70815223024f19cd1b" prot="public">
          <name>superlu_dist</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="Solv__Petsc_8h_1a5a0a487c7e0e114f4d92a88e2a5808b6aaf77cfaeac95d5bb680e1b2603d23ae1" prot="public">
          <name>petsc</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="Solv__Petsc_8h_1a5a0a487c7e0e114f4d92a88e2a5808b6ad25605924f9b1643dcc298a4eba5a84f" prot="public">
          <name>umfpack</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="Solv__Petsc_8h_1a5a0a487c7e0e114f4d92a88e2a5808b6aa663c1c6ebfd318f067db896735d4481" prot="public">
          <name>pastix</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="Solv__Petsc_8h_1a5a0a487c7e0e114f4d92a88e2a5808b6abc3895945aa136c66ea71a53a6fae6c7" prot="public">
          <name>cholmod</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="Solv__Petsc_8h_1a5a0a487c7e0e114f4d92a88e2a5808b6a317cd22292a531d4c3b895a93198311c" prot="public">
          <name>strumpack</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="Solv__Petsc_8h_1a5a0a487c7e0e114f4d92a88e2a5808b6a1ff272a9a5361e482e6748be5e449bbd" prot="public">
          <name>cli</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/Kernel/Math/SolvSys/Solv_Petsc.h" line="36" column="1" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/Kernel/Math/SolvSys/Solv_Petsc.h" bodystart="36" bodyend="36"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="var">
      <memberdef kind="variable" id="Solv__Petsc_8h_1a868dd49623b0c47d8c5fea7b9e7745b2" prot="public" static="no" mutable="no">
        <type>bool</type>
        <definition>bool gmres_right_unpreconditionned</definition>
        <argsstring></argsstring>
        <name>gmres_right_unpreconditionned</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/Kernel/Math/SolvSys/Solv_Petsc.h" line="37" column="13" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/Kernel/Math/SolvSys/Solv_Petsc.cpp" bodystart="205" bodyend="-1" declfile="/volatile/catA/gj277443/TRUST/sync-doc/src/Kernel/Math/SolvSys/Solv_Petsc.h" declline="37" declcolumn="13"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/****************************************************************************</highlight></codeline>
<codeline lineno="2"><highlight class="comment">*<sp/>Copyright<sp/>(c)<sp/>2025,<sp/>CEA</highlight></codeline>
<codeline lineno="3"><highlight class="comment">*<sp/>All<sp/>rights<sp/>reserved.</highlight></codeline>
<codeline lineno="4"><highlight class="comment">*</highlight></codeline>
<codeline lineno="5"><highlight class="comment">*<sp/>Redistribution<sp/>and<sp/>use<sp/>in<sp/>source<sp/>and<sp/>binary<sp/>forms,<sp/>with<sp/>or<sp/>without<sp/>modification,<sp/>are<sp/>permitted<sp/>provided<sp/>that<sp/>the<sp/>following<sp/>conditions<sp/>are<sp/>met:</highlight></codeline>
<codeline lineno="6"><highlight class="comment">*<sp/>1.<sp/>Redistributions<sp/>of<sp/>source<sp/>code<sp/>must<sp/>retain<sp/>the<sp/>above<sp/>copyright<sp/>notice,<sp/>this<sp/>list<sp/>of<sp/>conditions<sp/>and<sp/>the<sp/>following<sp/>disclaimer.</highlight></codeline>
<codeline lineno="7"><highlight class="comment">*<sp/>2.<sp/>Redistributions<sp/>in<sp/>binary<sp/>form<sp/>must<sp/>reproduce<sp/>the<sp/>above<sp/>copyright<sp/>notice,<sp/>this<sp/>list<sp/>of<sp/>conditions<sp/>and<sp/>the<sp/>following<sp/>disclaimer<sp/>in<sp/>the<sp/>documentation<sp/>and/or<sp/>other<sp/>materials<sp/>provided<sp/>with<sp/>the<sp/>distribution.</highlight></codeline>
<codeline lineno="8"><highlight class="comment">*<sp/>3.<sp/>Neither<sp/>the<sp/>name<sp/>of<sp/>the<sp/>copyright<sp/>holder<sp/>nor<sp/>the<sp/>names<sp/>of<sp/>its<sp/>contributors<sp/>may<sp/>be<sp/>used<sp/>to<sp/>endorse<sp/>or<sp/>promote<sp/>products<sp/>derived<sp/>from<sp/>this<sp/>software<sp/>without<sp/>specific<sp/>prior<sp/>written<sp/>permission.</highlight></codeline>
<codeline lineno="9"><highlight class="comment">*</highlight></codeline>
<codeline lineno="10"><highlight class="comment">*<sp/>THIS<sp/>SOFTWARE<sp/>IS<sp/>PROVIDED<sp/>BY<sp/>THE<sp/>COPYRIGHT<sp/>HOLDERS<sp/>AND<sp/>CONTRIBUTORS<sp/>&quot;AS<sp/>IS&quot;<sp/>AND<sp/>ANY<sp/>EXPRESS<sp/>OR<sp/>IMPLIED<sp/>WARRANTIES,<sp/>INCLUDING,<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO,<sp/>THE<sp/>IMPLIED<sp/>WARRANTIES<sp/>OF<sp/>MERCHANTABILITY<sp/>AND<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE<sp/>ARE<sp/>DISCLAIMED.</highlight></codeline>
<codeline lineno="11"><highlight class="comment">*<sp/>IN<sp/>NO<sp/>EVENT<sp/>SHALL<sp/>THE<sp/>COPYRIGHT<sp/>HOLDER<sp/>OR<sp/>CONTRIBUTORS<sp/>BE<sp/>LIABLE<sp/>FOR<sp/>ANY<sp/>DIRECT,<sp/>INDIRECT,<sp/>INCIDENTAL,<sp/>SPECIAL,<sp/>EXEMPLARY,<sp/>OR<sp/>CONSEQUENTIAL<sp/>DAMAGES<sp/>(INCLUDING,<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO,<sp/>PROCUREMENT<sp/>OF<sp/>SUBSTITUTE<sp/>GOODS<sp/>OR<sp/>SERVICES;<sp/>LOSS<sp/>OF<sp/>USE,<sp/>DATA,<sp/>OR<sp/>PROFITS;</highlight></codeline>
<codeline lineno="12"><highlight class="comment">*<sp/>OR<sp/>BUSINESS<sp/>INTERRUPTION)<sp/>HOWEVER<sp/>CAUSED<sp/>AND<sp/>ON<sp/>ANY<sp/>THEORY<sp/>OF<sp/>LIABILITY,<sp/>WHETHER<sp/>IN<sp/>CONTRACT,<sp/>STRICT<sp/>LIABILITY,<sp/>OR<sp/>TORT<sp/>(INCLUDING<sp/>NEGLIGENCE<sp/>OR<sp/>OTHERWISE)<sp/>ARISING<sp/>IN<sp/>ANY<sp/>WAY<sp/>OUT<sp/>OF<sp/>THE<sp/>USE<sp/>OF<sp/>THIS<sp/>SOFTWARE,<sp/>EVEN<sp/>IF<sp/>ADVISED<sp/>OF<sp/>THE<sp/>POSSIBILITY<sp/>OF<sp/>SUCH<sp/>DAMAGE.</highlight></codeline>
<codeline lineno="13"><highlight class="comment">*</highlight></codeline>
<codeline lineno="14"><highlight class="comment">*****************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>Solv_Petsc_included</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>Solv_Petsc_included</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;petsc_for_kernel.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;EChaine.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;Nom.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#undef<sp/>setbit<sp/></highlight><highlight class="comment">//<sp/>Sinon<sp/>conflit<sp/>de<sp/>ArrOfBit.h<sp/>avec<sp/>Petsc</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;Solv_Externe.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;ArrOfBit.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>PETSCKSP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;petscdm.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;TRUSTTab.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;PCShell_base.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;TRUST_Deriv.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classMatrice__Morse__Sym" kindref="compound">Matrice_Morse_Sym</ref>;</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classMatrice__Morse" kindref="compound">Matrice_Morse</ref>;</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/>solveur_direct_<sp/>{<sp/>no,<sp/>mumps,<sp/>superlu_dist,<sp/>petsc,<sp/>umfpack,<sp/>pastix,<sp/>cholmod,<sp/>strumpack,<sp/>cli<sp/>};</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>gmres_right_unpreconditionned;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Struct<sp/>to<sp/>associate<sp/>Petsc<sp/>preconditionner<sp/>to<sp/>user-provided<sp/>preconditioner<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40" refid="structPCstruct" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal">{</highlight></codeline>
<codeline lineno="42" refid="structPCstruct_1aca445d76cf64c32fb3b786b1519eb612" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="structPCstruct_1aca445d76cf64c32fb3b786b1519eb612" kindref="member">OWN_PTR</ref>(<ref refid="classPCShell__base" kindref="compound">PCShell_base</ref>)<sp/>pc_shell;</highlight></codeline>
<codeline lineno="43"><highlight class="normal">}<sp/><ref refid="structPCstruct" kindref="compound">PCstruct</ref>;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="46" refid="classSolv__Petsc" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classSolv__Petsc" kindref="compound">Solv_Petsc</ref><sp/>:<sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classSolv__Externe" kindref="compound">Solv_Externe</ref></highlight></codeline>
<codeline lineno="47"><highlight class="normal">{</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/>Declare_instanciable_sans_constructeur_ni_destructeur(<ref refid="classSolv__Petsc" kindref="compound">Solv_Petsc</ref>);</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal">public<sp/>:</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a4e84a4f162efc695050b42614f156f18" kindref="member">Solv_Petsc</ref>();</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a1eb40803f0ecca95f78642d04f25442d" kindref="member">~Solv_Petsc</ref>()<sp/></highlight><highlight class="keyword">override</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Method<sp/>which<sp/>be<sp/>called<sp/>to<sp/>create<sp/>solver<sp/>from<sp/>chaine_lue_</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56" refid="classSolv__Petsc_1aadf8a31f10d3c0c64ea9d42471121993" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1aadf8a31f10d3c0c64ea9d42471121993" kindref="member">create_solver</ref>()</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classEChaine" kindref="compound">EChaine</ref><sp/>e(<ref refid="classSolveurSys__base_1afe094450db2e5697da7b535437bd71b9" kindref="member">chaine_lue_</ref>);</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classSolv__Petsc_1aadf8a31f10d3c0c64ea9d42471121993" kindref="member">create_solver</ref>(e);</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="61" refid="classSolv__Petsc_1a481f3c404780440eaa22fdefef4aecbe" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a481f3c404780440eaa22fdefef4aecbe" kindref="member">solveur_direct</ref>()</highlight><highlight class="keyword"><sp/>const<sp/>override</highlight></codeline>
<codeline lineno="62"><highlight class="keyword"><sp/><sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>PETSCKSP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(SolveurPetsc_==</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/><ref refid="classProcess_1acc2fbbe761e08e5870ae605c0705491c" kindref="member">Process::exit</ref>(</highlight><highlight class="stringliteral">&quot;Can&apos;t<sp/>call<sp/>to<sp/>Solv_Petsc::solveur_direct()<sp/>yet.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(solveur_direct_&gt;0);</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1ad03765ac5cfa376cc07d872e44c8bc71" kindref="member">resoudre_systeme</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMatrice__Base" kindref="compound">Matrice_Base</ref>&amp;,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;,<sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>)<sp/></highlight><highlight class="keyword">override</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="69" refid="classSolv__Petsc_1a4a56ff0c43aee8adfb40a7229b7fafe0" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a4a56ff0c43aee8adfb40a7229b7fafe0" kindref="member">resoudre_systeme</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMatrice__Base" kindref="compound">Matrice_Base</ref>&amp;<sp/>M,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>A,<sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>B,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>niter_max)</highlight><highlight class="keyword"><sp/>override</highlight></codeline>
<codeline lineno="70"><highlight class="keyword"><sp/><sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1ad03765ac5cfa376cc07d872e44c8bc71" kindref="member">resoudre_systeme</ref>(M,A,B);</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1aadf8a31f10d3c0c64ea9d42471121993" kindref="member">create_solver</ref>(<ref refid="classEntree" kindref="compound">Entree</ref>&amp;);</highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>PETSCKSP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>To<sp/>switch<sp/>between<sp/>solver<sp/>definitions<sp/>in<sp/>one<sp/>Solv_Petsc<sp/>instance:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>reset_solver(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/>name)</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ToDo:<sp/>regler<sp/>option_prefix_<sp/>et<sp/>numero_solveur<sp/>dans<sp/>create_solver<sp/>et<sp/>initialize...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classSolv__Petsc_1a34cc0b975e06dc6df27f2cc6d89da2dd" kindref="member">reset</ref>();</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Setting<sp/>PETSc<sp/>solver:<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>name<sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classEChaine" kindref="compound">EChaine</ref><sp/>ech(name);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classSolv__Petsc_1aadf8a31f10d3c0c64ea9d42471121993" kindref="member">create_solver</ref>(ech);</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a34cc0b975e06dc6df27f2cc6d89da2dd" kindref="member">reset</ref>();</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>PETSCKSP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc" kindref="compound">Solv_Petsc</ref>&amp;<sp/><ref refid="classObjet__U_1a0e056c7aeee257fa5cf0a6e2906d9ff1" kindref="member">operator=</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc" kindref="compound">Solv_Petsc</ref>&amp;);</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a4e84a4f162efc695050b42614f156f18" kindref="member">Solv_Petsc</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc" kindref="compound">Solv_Petsc</ref>&amp;);</highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>initialize();</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>gpu()</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="92"><highlight class="keyword"><sp/><sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a5f603c229087d42c8bb2fee48290526f" kindref="member">gpu_</ref>;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="structPCstruct" kindref="compound">PCstruct</ref>&amp;<sp/>get_precond_user()</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pc_user_.pc_shell.est_nul())<sp/><ref refid="classSolv__Petsc_1aadf8a31f10d3c0c64ea9d42471121993" kindref="member">create_solver</ref>();</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pc_user_;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>amgx()</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="101"><highlight class="keyword"><sp/><sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a4a4d7d01f00900e4c2ad771be5e6725b" kindref="member">amgx_</ref>;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>amgx_initialized()</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a7244784294055ac6cd06c16d5d7264e7" kindref="member">amgx_initialized_</ref>;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/>PetscErrorCode<sp/>set_convergence_test(PetscErrorCode<sp/>(*converge)(KSP,PetscInt,PetscReal,KSPConvergedReason*,</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*),</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*cctx,PetscErrorCode<sp/>(*destroy)(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*))</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(SolveurPetsc_==</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/><ref refid="classSolv__Petsc_1aadf8a31f10d3c0c64ea9d42471121993" kindref="member">create_solver</ref>();</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>KSPSetConvergenceTest(SolveurPetsc_,<sp/>converge,<sp/>cctx,<sp/>destroy);</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Timers:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>PetscLogStage<sp/>KSPSolve_Stage_;</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>PetscLogStage<sp/>Create_Stage_;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>set_rtol(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal">&amp;<sp/>rtol)</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>seuil_relatif_<sp/>=<sp/>rtol;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(SolveurPetsc_!=</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>KSPSetTolerances(SolveurPetsc_,<sp/>seuil_relatif_,<sp/>seuil_,<sp/>(divtol_==0<sp/>?<sp/>PETSC_DEFAULT<sp/>:<sp/>divtol_),<sp/>nb_it_max_);</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122" refid="classSolv__Petsc_1a7384c2681936b980c3fa393793e47e87" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a7384c2681936b980c3fa393793e47e87" kindref="member">instance</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Nombre<sp/>d&apos;instances<sp/>en<sp/>cours<sp/>de<sp/>la<sp/>classe</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123" refid="classSolv__Petsc_1acc3475bd78fb4ceace2d10ff68de1dd8" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1acc3475bd78fb4ceace2d10ff68de1dd8" kindref="member">numero_solveur</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Compte<sp/>les<sp/>solveurs<sp/>crees<sp/>et<sp/>utilises<sp/>pour<sp/>le<sp/>prefix<sp/>des<sp/>options</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal">protected<sp/>:</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>PETSCKSP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">using</highlight><highlight class="normal"><sp/>ArrOfPetscInt<sp/>=<sp/><ref refid="classTRUSTArray" kindref="compound">TRUSTArray&lt;PetscInt, PetscInt&gt;</ref>;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>isViennaCLVector();</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>check_aij(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMatrice__Morse" kindref="compound">Matrice_Morse</ref>&amp;);</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>Create_DM(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>);<sp/></highlight><highlight class="comment">//<sp/>Construit<sp/>un<sp/>DM<sp/>(Distributed<sp/>Mesh)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">virtual</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>Create_objects(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMatrice__Morse" kindref="compound">Matrice_Morse</ref>&amp;,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">);<sp/></highlight><highlight class="comment">//<sp/>Construit<sp/>differents<sp/>objets<sp/>PETSC<sp/>dont<sp/>matrice</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">virtual</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>Create_vectors(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;);<sp/></highlight><highlight class="comment">//<sp/>Construit<sp/>les<sp/>vecteurs<sp/>Petsc<sp/>x<sp/>et<sp/>b</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">virtual</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>Update_vectors(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>secmem,<sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>solution);<sp/></highlight><highlight class="comment">//<sp/>Remplit<sp/>les<sp/>vecteurs<sp/>Petsc<sp/>x<sp/>et<sp/>b</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>Create_MatricePetsc(Mat&amp;,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMatrice__Morse" kindref="compound">Matrice_Morse</ref>&amp;);<sp/></highlight><highlight class="comment">//<sp/>Construit<sp/>et<sp/>remplit<sp/>une<sp/>matrice<sp/>Petsc<sp/>depuis<sp/>la<sp/>matrice_morse</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">virtual</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>Update_matrix(Mat&amp;<sp/>MatricePetsc,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMatrice__Morse" kindref="compound">Matrice_Morse</ref>&amp;<sp/>mat_morse);<sp/></highlight><highlight class="comment">//<sp/>Fill<sp/>the<sp/>(previously<sp/>allocated)<sp/>PETSc<sp/>matrix<sp/>with<sp/>mat_morse<sp/>coefficients</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">virtual</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classSolv__Externe_1ae477e8000cb545a13e1736c673d74af9" kindref="member">Update_solution</ref>(<ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>solution);</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">virtual</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>solve(<ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref>&amp;<sp/>residual);<sp/></highlight><highlight class="comment">//<sp/>Solve<sp/>Ax=b<sp/>and<sp/>return<sp/>residual</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">virtual</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>finalize()<sp/>{};</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">virtual</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>detect_new_stencil(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMatrice__Morse" kindref="compound">Matrice_Morse</ref>&amp;);</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>nouveau_stencil()</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>nouveau_stencil_;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/>};<sp/></highlight><highlight class="comment">//<sp/>ToDo:<sp/>Remonter<sp/>dans<sp/>Solveur_Sys<sp/>avec<sp/>nouvelle_matrice</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>enable_ksp_view();</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>has_option(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/><ref refid="classoption" kindref="compound">option</ref>,<sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/>current_value);</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>add_option(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/><ref refid="classoption" kindref="compound">option</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal">&amp;<sp/>value,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>cli<sp/>=<sp/>0);</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>add_option(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/><ref refid="classoption" kindref="compound">option</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/>value,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>cli<sp/>=<sp/>0);</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>add_amgx_option(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/>key,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/>value,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>comment=</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>add_amgx_option(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/>key_value);</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>SaveObjectsToFile(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>b,<sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>x);</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>RestoreMatrixFromFile();</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/>PetscInt<sp/>compute_nb_rows_petsc(PetscInt);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Attributes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>seuil_;</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>seuil_relatif_;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>divtol_;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>nouveau_stencil_<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Objets<sp/>Petsc</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/>Mat<sp/>MatricePetsc_;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/>Vec<sp/>SecondMembrePetsc_;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/>Vec<sp/>SolutionPetsc_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Globale<sp/>solution</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/>KSP<sp/>SolveurPetsc_;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/>PC<sp/>PreconditionneurPetsc_;</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><ref refid="structPCstruct" kindref="compound">PCstruct</ref><sp/>pc_user_;<sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>user-defined<sp/>preconditioner<sp/>context<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/>DM<sp/>dm_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//description<sp/>de<sp/>champs<sp/>PETSC</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>preconditionnement_non_symetrique_;<sp/></highlight><highlight class="comment">//<sp/>Drapeau<sp/>sur<sp/>la<sp/>symetrie<sp/>de<sp/>la<sp/>matrice<sp/>de<sp/>preconditionnement</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nb_it_max_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Maximal<sp/>number<sp/>of<sp/>iterations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>convergence_with_nb_it_max_;<sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Convergence<sp/>decided<sp/>with<sp/>nb_it_max_<sp/>specified<sp/>and<sp/>not<sp/>by<sp/>seuil<sp/>threshold</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ignore_nb_it_max_;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>controle_residu_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Verification<sp/>si<sp/>le<sp/>residu<sp/>||Ax-B||&lt;seuil</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>block_size_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Block<sp/>size<sp/>for<sp/>SBAIJ<sp/>matrix</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>factored_matrix_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Deal<sp/>with<sp/>the<sp/>A=LU<sp/>factorization<sp/>on<sp/>disk</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>mataij_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Force<sp/>the<sp/>use<sp/>of<sp/>a<sp/>Mataij<sp/>matrix</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>type_pc_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Preconditioner<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>type_ksp_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>KSP<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>option_prefix_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Prefix<sp/>des<sp/>options<sp/>CLI<sp/>(permet<sp/>de<sp/>faire<sp/>plusieurs<sp/>solveurs<sp/>en<sp/>CLI)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>amgx_options_;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>petsc_nb_cpus_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Number<sp/>of<sp/>CPUs<sp/>used<sp/>to<sp/>solve<sp/>the<sp/>PETSc<sp/>matrix</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>petsc_cpus_selection_;<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Selection<sp/>of<sp/>CPUs<sp/>used<sp/>to<sp/>solve<sp/>the<sp/>PETSc<sp/>matrix</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>different_partition_;<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Different<sp/>partition<sp/>for<sp/>the<sp/>TRUST<sp/>matrix<sp/>and<sp/>the<sp/>PETSc<sp/>matrix</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>petsc_decide_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>PETSc<sp/>decide<sp/>of<sp/>the<sp/>matrix<sp/>partition</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/>Vec<sp/>LocalSolutionPetsc_;<sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Local<sp/>solution<sp/>in<sp/>case<sp/>of<sp/>petsc_decide_=1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/>VecScatter<sp/>VecScatter_;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Scatter<sp/>context<sp/>needed<sp/>when<sp/>petsc_decide_=1<sp/>to<sp/>gather<sp/>values<sp/>of<sp/>global<sp/>to<sp/>local<sp/>solution</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"></highlight></codeline>
<codeline lineno="191" refid="classSolv__Petsc_1aa05df5e1a45d2e1edff22af140336a05" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>solveur_direct_<sp/>=<sp/>no;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Pour<sp/>savoir<sp/>si<sp/>l&apos;on<sp/>manipule<sp/>un<sp/>solveur<sp/>direct<sp/>et<sp/>non<sp/>iteratif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192" refid="classSolv__Petsc_1a5f603c229087d42c8bb2fee48290526f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a5f603c229087d42c8bb2fee48290526f" kindref="member">gpu_</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Utilisation<sp/>des<sp/>solveurs<sp/>GPU<sp/>de<sp/>PETSc</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="193" refid="classSolv__Petsc_1a4a4d7d01f00900e4c2ad771be5e6725b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a4a4d7d01f00900e4c2ad771be5e6725b" kindref="member">amgx_</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Utilisation<sp/>des<sp/>solveurs<sp/>GPU<sp/>de<sp/>AMGX</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/><ref refid="classSolv__Petsc_1af626ce7ac5babfaf8333057766ac15cf" kindref="member">config</ref>();<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Nom<sp/>du<sp/>fichier<sp/>de<sp/>config<sp/>eventuel</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="195" refid="classSolv__Petsc_1a7244784294055ac6cd06c16d5d7264e7" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a7244784294055ac6cd06c16d5d7264e7" kindref="member">amgx_initialized_</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Amgx<sp/>initialise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Options<sp/>dev:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197" refid="classSolv__Petsc_1a1d87d8f7f3be6d318bc343e11059cde2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a1d87d8f7f3be6d318bc343e11059cde2" kindref="member">ignore_new_nonzero_</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="198" refid="classSolv__Petsc_1a895816a337ad6bc6fcdfb82037e6a837" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a895816a337ad6bc6fcdfb82037e6a837" kindref="member">rebuild_matrix_</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="199" refid="classSolv__Petsc_1a45df7a11f976ea94cbb622ae8fcbd181" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a45df7a11f976ea94cbb622ae8fcbd181" kindref="member">allow_realloc_</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="200" refid="classSolv__Petsc_1a25a8675591718c29d6eff7e402da0a08" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a25a8675591718c29d6eff7e402da0a08" kindref="member">mat_ignore_zero_entries_</ref>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="201" refid="classSolv__Petsc_1a7406167837df3705635a2c270e738630" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a7406167837df3705635a2c270e738630" kindref="member">reduce_ram_</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="202" refid="classSolv__Petsc_1a74dac05c9ed8acbc0642cfee0d750f4e" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a74dac05c9ed8acbc0642cfee0d750f4e" kindref="member">verbose</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>Timing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203" refid="classSolv__Petsc_1add7d1d8a5e08095450d5e7493c480429" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1add7d1d8a5e08095450d5e7493c480429" kindref="member">reorder_matrix_</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Reuse<sp/>preconditioner<sp/>(for<sp/>Inexact<sp/>Newton):</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="205" refid="classSolv__Petsc_1af959f8858cd1e7ef1ff735bce243c6af" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1af959f8858cd1e7ef1ff735bce243c6af" kindref="member">nb_it_previous_</ref>=-1;<sp/><sp/></highlight><highlight class="comment">//<sp/>Previous<sp/>number<sp/>of<sp/>iterations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206" refid="classSolv__Petsc_1a7bd3abda8df421803f779b1b5862e8ad" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a7bd3abda8df421803f779b1b5862e8ad" kindref="member">reuse_preconditioner_nb_it_max_</ref>=-1;<sp/></highlight><highlight class="comment">//<sp/>Upper<sp/>limit<sp/>of<sp/>iterations<sp/>to<sp/>reuse<sp/>preconditioner</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>PETSCKSP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/>IS<sp/>rowperm<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/>colperm<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/>IS<sp/>inv_rowperm<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/>inv_colperm<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal">};</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>NB_IT_MAX_DEFINED<sp/>10000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="215" refid="classSolv__Petsc_1a4e84a4f162efc695050b42614f156f18" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a4e84a4f162efc695050b42614f156f18" kindref="member">Solv_Petsc::Solv_Petsc</ref>()</highlight></codeline>
<codeline lineno="216"><highlight class="normal">{</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>PETSCKSP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/>initialize();</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a7384c2681936b980c3fa393793e47e87" kindref="member">instance</ref>++;</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>Journal()&lt;&lt;&quot;creation<sp/>solv_petsc<sp/>&quot;&lt;&lt;instance&lt;&lt;finl;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal">}</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="224" refid="classSolv__Petsc_1a1eb40803f0ecca95f78642d04f25442d" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a1eb40803f0ecca95f78642d04f25442d" kindref="member">Solv_Petsc::~Solv_Petsc</ref>()</highlight></codeline>
<codeline lineno="225"><highlight class="normal">{</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a34cc0b975e06dc6df27f2cc6d89da2dd" kindref="member">reset</ref>();</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a7384c2681936b980c3fa393793e47e87" kindref="member">instance</ref>--;</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Journal()&lt;&lt;&quot;<sp/>destr<sp/>solv_petsc<sp/>&quot;&lt;&lt;instance&lt;&lt;finl;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal">}</highlight></codeline>
<codeline lineno="230" refid="classSolv__Petsc_1a34cc0b975e06dc6df27f2cc6d89da2dd" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a34cc0b975e06dc6df27f2cc6d89da2dd" kindref="member">Solv_Petsc::reset</ref>()</highlight></codeline>
<codeline lineno="231"><highlight class="normal">{</highlight></codeline>
<codeline lineno="232"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>PETSCKSP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(SolveurPetsc_!=</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>KSPDestroy(&amp;SolveurPetsc_);</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>finalize();</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(MatricePetsc_!=</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Destruction<sp/>des<sp/>vecteurs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>VecDestroy(&amp;SecondMembrePetsc_);</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>VecDestroy(&amp;SolutionPetsc_);</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(LocalSolutionPetsc_!=</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>VecDestroy(&amp;LocalSolutionPetsc_);</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>VecScatterDestroy(&amp;VecScatter_);</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Destruction<sp/>matrice</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>MatDestroy(&amp;MatricePetsc_);</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Destruction<sp/>DM</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dm_!=</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DMDestroy(&amp;dm_);</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Destruction<sp/>IS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rowperm!=</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ISDestroy(&amp;rowperm),<sp/>ISDestroy(&amp;inv_rowperm);</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(colperm!=</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ISDestroy(&amp;colperm),<sp/>ISDestroy(&amp;inv_colperm);</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/>initialize();</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal">}</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>PETSCKSP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>Solv_Petsc::initialize()</highlight></codeline>
<codeline lineno="265"><highlight class="normal">{</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Externe_1a0d0911b59e2b185682629a3a77e07578" kindref="member">matrice_symetrique_</ref>=-1;</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/>preconditionnement_non_symetrique_=0;</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/>seuil_<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/>seuil_relatif_<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/>divtol_<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/>nouveau_stencil_<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/>petsc_cpus_selection_<sp/>=<sp/>0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>By<sp/>default,<sp/>0<sp/>(no<sp/>selection).<sp/>1<sp/>means:<sp/>first<sp/>petsc_nb_cpus_<sp/>CPUs<sp/>is<sp/>used,<sp/>2<sp/>means:<sp/>every<sp/>petsc_nb_cpus_<sp/>CPUs<sp/>is<sp/>used</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/>petsc_nb_cpus_<sp/>=<sp/><ref refid="classProcess_1a6bf692ce58d9578aa62ac3c07b8caaa1" kindref="member">Process::nproc</ref>();<sp/></highlight><highlight class="comment">//<sp/>By<sp/>default<sp/>the<sp/>number<sp/>of<sp/>processes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/>different_partition_<sp/>=<sp/>0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>By<sp/>default,<sp/>same<sp/>matrix<sp/>partition</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/>petsc_decide_<sp/>=<sp/>0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>By<sp/>default,<sp/>0.<sp/>1<sp/>is<sp/>OK<sp/>but<sp/>does<sp/>NOT<sp/>improve<sp/>performance<sp/>(rather<sp/>decrease)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/>convergence_with_nb_it_max_<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/>ignore_nb_it_max_<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/>nb_it_max_<sp/>=<sp/>NB_IT_MAX_DEFINED;</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/>mataij_=0;</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/>factored_matrix_=</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/>solveur_direct_=no;</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/>controle_residu_=0;</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a5f603c229087d42c8bb2fee48290526f" kindref="member">gpu_</ref>=</highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a4a4d7d01f00900e4c2ad771be5e6725b" kindref="member">amgx_</ref>=</highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a7244784294055ac6cd06c16d5d7264e7" kindref="member">amgx_initialized_</ref>=</highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/>block_size_=1;</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/>option_prefix_=</highlight><highlight class="stringliteral">&quot;??&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/>dm_=</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/>MatricePetsc_<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/>SecondMembrePetsc_<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/>SolutionPetsc_<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/>SolveurPetsc_<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/>LocalSolutionPetsc_<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/>VecScatter_<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Dev:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a1d87d8f7f3be6d318bc343e11059cde2" kindref="member">ignore_new_nonzero_</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a895816a337ad6bc6fcdfb82037e6a837" kindref="member">rebuild_matrix_</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a45df7a11f976ea94cbb622ae8fcbd181" kindref="member">allow_realloc_</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a25a8675591718c29d6eff7e402da0a08" kindref="member">mat_ignore_zero_entries_</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1add7d1d8a5e08095450d5e7493c480429" kindref="member">reorder_matrix_</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a7406167837df3705635a2c270e738630" kindref="member">reduce_ram_</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classSolv__Petsc_1a7384c2681936b980c3fa393793e47e87" kindref="member">instance</ref>==-1)</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>initialization:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classSolv__Petsc_1a7384c2681936b980c3fa393793e47e87" kindref="member">instance</ref>=0;</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>version[256];</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>PetscGetVersion(version,256);</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;******************************************************************************************&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Commands<sp/>lines<sp/>possible<sp/>for<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>version<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;:&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;-ksp_view<sp/>:<sp/>to<sp/>have<sp/>some<sp/>informations<sp/>on<sp/>the<sp/>solver/preconditioner<sp/>used<sp/>by<sp/>PETSc.&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;-info<sp/>:<sp/>to<sp/>have<sp/>among<sp/>other<sp/>informations<sp/>on<sp/>storage<sp/>of<sp/>matrices<sp/>of<sp/>PETSc.&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;-log_summary<sp/>:<sp/>to<sp/>have<sp/>at<sp/>the<sp/>end<sp/>of<sp/>the<sp/>calculation,<sp/>informations<sp/>about<sp/>performances<sp/>and<sp/>memory.&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;-log_all<sp/>:<sp/>trace<sp/>all<sp/>PETSc<sp/>calls.&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;-malloc_dump<sp/>:<sp/>to<sp/>have<sp/>at<sp/>the<sp/>end<sp/>of<sp/>the<sp/>calculation<sp/>the<sp/>memory<sp/>not<sp/>deallocated<sp/>by<sp/>PETSc.&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;-help<sp/>:<sp/>to<sp/>know<sp/>all<sp/>the<sp/>commands<sp/>lines<sp/>of<sp/>PETSc<sp/>including<sp/>those<sp/>related<sp/>to<sp/>the<sp/>solver/preconditioner<sp/>selected.&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;******************************************************************************************&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classObjet__U_1a35bd818d76310c3a9d9594a6c6fa5905" kindref="member">disable_TU</ref>)</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;NB:<sp/>if<sp/>you<sp/>want<sp/>to<sp/>disable<sp/>the<sp/>wrinting<sp/>of<sp/>the<sp/>*_petsc.TU<sp/>file<sp/>then<sp/>specify<sp/>the<sp/>disable_TU<sp/>flag<sp/>in<sp/>your<sp/>datafile<sp/>before<sp/>reading<sp/>the<sp/>block<sp/>of<sp/>schema<sp/>in<sp/>time.&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Reading<sp/>of<sp/>disable_TU<sp/>flag<sp/>=&gt;<sp/>Disable<sp/>the<sp/>writing<sp/>of<sp/>the<sp/>*_petsc.TU<sp/>file.&quot;</highlight><highlight class="normal">&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>PetscLogStageRegister(</highlight><highlight class="stringliteral">&quot;CreateStage&quot;</highlight><highlight class="normal">,&amp;Create_Stage_);</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>PetscLogStageRegister(</highlight><highlight class="stringliteral">&quot;KSPSolve&quot;</highlight><highlight class="normal">,&amp;KSPSolve_Stage_);</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="324"><highlight class="normal">}</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc_1a4e84a4f162efc695050b42614f156f18" kindref="member">Solv_Petsc::Solv_Petsc</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc" kindref="compound">Solv_Petsc</ref>&amp;<sp/>org):<ref refid="classSolv__Externe" kindref="compound">Solv_Externe</ref>::<ref refid="classSolv__Externe" kindref="compound">Solv_Externe</ref>()</highlight></codeline>
<codeline lineno="327"><highlight class="normal">{</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/>initialize();</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a7384c2681936b980c3fa393793e47e87" kindref="member">instance</ref>++;</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Journal()&lt;&lt;&quot;copie<sp/>solv_petsc<sp/>&quot;&lt;&lt;instance&lt;&lt;finl;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><ref refid="classSolveurSys__base_1ab5dd43c8033d107357e5c2d1aea565c9" kindref="member">set_read_matrix</ref>(org.<ref refid="classSolveurSys__base_1a0a95f84b624d297dce073c7cf062d988" kindref="member">read_matrix</ref>());</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a5f603c229087d42c8bb2fee48290526f" kindref="member">gpu_</ref>=org.gpu();</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><ref refid="classSolv__Petsc_1a4a4d7d01f00900e4c2ad771be5e6725b" kindref="member">amgx_</ref>=org.amgx();</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/>option_prefix_=org.option_prefix_;</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>on<sp/>relance<sp/>la<sp/>lecture<sp/>....</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><ref refid="classEChaine" kindref="compound">EChaine</ref><sp/>recup(org.<ref refid="classSolveurSys__base_1a37ee1ac4f2a7c4438df6a806488c7c46" kindref="member">get_chaine_lue</ref>());</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><ref refid="classObjet__U_1a6f4c7788efee2dce629ebd1628b73288" kindref="member">readOn</ref>(recup);</highlight></codeline>
<codeline lineno="338"><highlight class="normal">}</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc" kindref="compound">Solv_Petsc</ref>&amp;<sp/><ref refid="classObjet__U_1a0e056c7aeee257fa5cf0a6e2906d9ff1" kindref="member">Solv_Petsc::operator=</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classSolv__Petsc" kindref="compound">Solv_Petsc</ref>&amp;)</highlight></codeline>
<codeline lineno="341"><highlight class="normal">{</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/>Cerr&lt;&lt;</highlight><highlight class="stringliteral">&quot;Solv_Petsc::operator=(const<sp/>Solv_Petsc&amp;)<sp/>is<sp/>not<sp/>coded.&quot;</highlight><highlight class="normal">&lt;&lt;finl;</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><ref refid="classProcess_1acc2fbbe761e08e5870ae605c0705491c" kindref="member">exit</ref>();</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(*</highlight><highlight class="keyword">this</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="345"><highlight class="normal">}</highlight></codeline>
<codeline lineno="346"><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight></codeline>
<codeline lineno="349" refid="classoption" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classoption" kindref="compound">option</ref></highlight></codeline>
<codeline lineno="350"><highlight class="normal">{</highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="352" refid="classoption_1a111fcb2f43490d4a2b9c4227a6412b2f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classoption_1a111fcb2f43490d4a2b9c4227a6412b2f" kindref="member">defined</ref>;</highlight></codeline>
<codeline lineno="353" refid="classoption_1a38c4ce51346daeda4a76db767d8aac75" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/><ref refid="classoption_1a38c4ce51346daeda4a76db767d8aac75" kindref="member">name</ref>;</highlight></codeline>
<codeline lineno="354"><highlight class="normal">};</highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight></codeline>
<codeline lineno="356" refid="classoption__string" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classoption__string" kindref="compound">option_string</ref><sp/>:<sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classoption" kindref="compound">option</ref></highlight></codeline>
<codeline lineno="357"><highlight class="normal">{</highlight></codeline>
<codeline lineno="358"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="359" refid="classoption__string_1ac396314eb45f46478e22e72ac6b1c764" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="classoption__string_1ac396314eb45f46478e22e72ac6b1c764" kindref="member">option_string</ref>(<ref refid="classNom" kindref="compound">Nom</ref><sp/>n,<sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>v)</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classoption_1a111fcb2f43490d4a2b9c4227a6412b2f" kindref="member">defined</ref>=0;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classoption_1a38c4ce51346daeda4a76db767d8aac75" kindref="member">name</ref>=n;</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classoption__string_1a7213d936e12675fd5177c5114d0e3a77" kindref="member">value_</ref>=v;</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="365" refid="classoption__string_1a7213d936e12675fd5177c5114d0e3a77" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/><ref refid="classoption__string_1a7213d936e12675fd5177c5114d0e3a77" kindref="member">value_</ref>;</highlight></codeline>
<codeline lineno="366" refid="classoption__string_1ac0fa274649cf7c52c0def6c9095a30ce" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/><ref refid="classoption__string_1ac0fa274649cf7c52c0def6c9095a30ce" kindref="member">value</ref>()</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classoption__string_1a7213d936e12675fd5177c5114d0e3a77" kindref="member">value_</ref>;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="370"><highlight class="normal">};</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372" refid="classoption__int" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classoption__int" kindref="compound">option_int</ref><sp/>:<sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classoption" kindref="compound">option</ref></highlight></codeline>
<codeline lineno="373"><highlight class="normal">{</highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="375" refid="classoption__int_1a0ea9850a4a21f615906513ee7d9f5e54" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="classoption__int_1a0ea9850a4a21f615906513ee7d9f5e54" kindref="member">option_int</ref>(<ref refid="classNom" kindref="compound">Nom</ref><sp/>n,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>v)</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classoption_1a111fcb2f43490d4a2b9c4227a6412b2f" kindref="member">defined</ref>=0;</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classoption_1a38c4ce51346daeda4a76db767d8aac75" kindref="member">name</ref>=n;</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classoption__int_1a71eb633421e8e10901dc137cd0868d2d" kindref="member">value_</ref>=v;</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="381" refid="classoption__int_1a71eb633421e8e10901dc137cd0868d2d" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classoption__int_1a71eb633421e8e10901dc137cd0868d2d" kindref="member">value_</ref>;</highlight></codeline>
<codeline lineno="382" refid="classoption__int_1a3f9d1b5b2aa020c5db15e82bd3e829e2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">&amp;<sp/><ref refid="classoption__int_1a3f9d1b5b2aa020c5db15e82bd3e829e2" kindref="member">value</ref>()</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classoption__int_1a71eb633421e8e10901dc137cd0868d2d" kindref="member">value_</ref>;</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="386"><highlight class="normal">};</highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight></codeline>
<codeline lineno="388" refid="classoption__double" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classoption__double" kindref="compound">option_double</ref><sp/>:<sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classoption" kindref="compound">option</ref></highlight></codeline>
<codeline lineno="389"><highlight class="normal">{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="391" refid="classoption__double_1a8dfcbf17c3324d523af1edcfb83a299c" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="classoption__double_1a8dfcbf17c3324d523af1edcfb83a299c" kindref="member">option_double</ref>(<ref refid="classNom" kindref="compound">Nom</ref><sp/>n,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>v)</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classoption_1a111fcb2f43490d4a2b9c4227a6412b2f" kindref="member">defined</ref>=0;</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classoption_1a38c4ce51346daeda4a76db767d8aac75" kindref="member">name</ref>=n;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classoption__double_1a3e97e7d693e7c4ecfec2a21e61810c77" kindref="member">value_</ref>=v;</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="397" refid="classoption__double_1a3e97e7d693e7c4ecfec2a21e61810c77" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="classoption__double_1a3e97e7d693e7c4ecfec2a21e61810c77" kindref="member">value_</ref>;</highlight></codeline>
<codeline lineno="398" refid="classoption__double_1a3e595172f5d65c3c381fa1bae24d8e32" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal">&amp;<sp/><ref refid="classoption__double_1a3e595172f5d65c3c381fa1bae24d8e32" kindref="member">value</ref>()</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classoption__double_1a3e97e7d693e7c4ecfec2a21e61810c77" kindref="member">value_</ref>;</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="402"><highlight class="normal">};</highlight></codeline>
<codeline lineno="403"><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/Kernel/Math/SolvSys/Solv_Petsc.h"/>
  </compounddef>
</doxygen>
