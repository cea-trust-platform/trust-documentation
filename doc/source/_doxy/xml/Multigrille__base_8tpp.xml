<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.1" xml:lang="en-US">
  <compounddef id="Multigrille__base_8tpp" kind="file" language="C++">
    <compoundname>Multigrille_base.tpp</compoundname>
    <includes refid="IJK__VDF__converter_8h" local="no">IJK_VDF_converter.h</includes>
    <includes refid="Matrice__Morse__Sym_8h" local="no">Matrice_Morse_Sym.h</includes>
    <includes refid="IJK__Vector_8h" local="no">IJK_Vector.h</includes>
    <includes refid="Interprete__bloc_8h" local="no">Interprete_bloc.h</includes>
    <includes refid="Perf__counters_8h" local="no">Perf_counters.h</includes>
    <includedby refid="Multigrille__base_8h" local="no">Multigrille_base.h</includedby>
      <sectiondef kind="define">
      <memberdef kind="define" id="Multigrille__base_8tpp_1a4614f1f961f625c595e4e02178aab380" prot="public" static="no">
        <name>Multigrille_base_TPP_H</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" line="17" column="9" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" bodystart="17" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="Multigrille__base_8tpp_1a98ac64c6fc414da6eead363a32bb4cb4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <templateparamlist>
          <param>
            <type>typename _TYPE_</type>
          </param>
          <param>
            <type>typename _TYPE_ARRAY_</type>
          </param>
        </templateparamlist>
        <type>void</type>
        <definition>void ajoute_alpha_v</definition>
        <argsstring>(IJK_Field_template&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;x, _TYPE_ alpha, const IJK_Field_template&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;v)</argsstring>
        <name>ajoute_alpha_v</name>
        <param>
          <type><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>x</declname>
        </param>
        <param>
          <type>_TYPE_</type>
          <declname>alpha</declname>
        </param>
        <param>
          <type>const <ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>v</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" line="374" column="6" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" bodystart="374" bodyend="385"/>
      </memberdef>
      <memberdef kind="function" id="Multigrille__base_8tpp_1a6ad92c100ffde90fa986da607858bc95" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <templateparamlist>
          <param>
            <type>typename _TYPE_</type>
          </param>
          <param>
            <type>typename _TYPE_ARRAY_</type>
          </param>
        </templateparamlist>
        <type>double</type>
        <definition>double ajouter_alpha_v_multiple</definition>
        <argsstring>(IJK_Field_template&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;x, ArrOfDouble &amp;coeff, IJK_Vector&lt; IJK_Field_template, _TYPE_, _TYPE_ARRAY_ &gt; &amp;y, int n)</argsstring>
        <name>ajouter_alpha_v_multiple</name>
        <param>
          <type><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>x</declname>
        </param>
        <param>
          <type><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref> &amp;</type>
          <declname>coeff</declname>
        </param>
        <param>
          <type><ref refid="classIJK__Vector" kindref="compound">IJK_Vector</ref>&lt; <ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>, _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>y</declname>
        </param>
        <param>
          <type>int</type>
          <declname>n</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" line="484" column="8" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" bodystart="484" bodyend="505"/>
      </memberdef>
      <memberdef kind="function" id="Multigrille__base_8tpp_1a577f9c2aca226bcd29dcb1c1c9c467a3" prot="public" static="no" const="no" explicit="no" inline="yes" virt="non-virtual">
        <templateparamlist>
          <param>
            <type>typename _TYPE_</type>
          </param>
          <param>
            <type>typename _TYPE_ARRAY_</type>
          </param>
        </templateparamlist>
        <type>double</type>
        <definition>double ajouter_alpha_v_multiple_</definition>
        <argsstring>(IJK_Field_template&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;x, ArrOfDouble &amp;coeff, IJK_Vector&lt; IJK_Field_template, _TYPE_, _TYPE_ARRAY_ &gt; &amp;y, int n, int nfirst)</argsstring>
        <name>ajouter_alpha_v_multiple_</name>
        <param>
          <type><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>x</declname>
        </param>
        <param>
          <type><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref> &amp;</type>
          <declname>coeff</declname>
        </param>
        <param>
          <type><ref refid="classIJK__Vector" kindref="compound">IJK_Vector</ref>&lt; <ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>, _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>y</declname>
        </param>
        <param>
          <type>int</type>
          <declname>n</declname>
        </param>
        <param>
          <type>int</type>
          <declname>nfirst</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" line="442" column="15" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" bodystart="442" bodyend="478"/>
      </memberdef>
      <memberdef kind="function" id="Multigrille__base_8tpp_1a9bd69f35bbad09e9d7bb8421f992def3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <templateparamlist>
          <param>
            <type>typename _TYPE_</type>
          </param>
          <param>
            <type>typename _TYPE_ARRAY_</type>
          </param>
        </templateparamlist>
        <type>void</type>
        <definition>void calcul_produits_scalaires</definition>
        <argsstring>(IJK_Vector&lt; IJK_Field_template, _TYPE_, _TYPE_ARRAY_ &gt; &amp;x, ArrOfDouble &amp;resu)</argsstring>
        <name>calcul_produits_scalaires</name>
        <param>
          <type><ref refid="classIJK__Vector" kindref="compound">IJK_Vector</ref>&lt; <ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>, _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>x</declname>
        </param>
        <param>
          <type><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref> &amp;</type>
          <declname>resu</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" line="548" column="6" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" bodystart="548" bodyend="569"/>
      </memberdef>
      <memberdef kind="function" id="Multigrille__base_8tpp_1ad620bc82fd899d453a4e80de2828c4df" prot="public" static="no" const="no" explicit="no" inline="yes" virt="non-virtual">
        <templateparamlist>
          <param>
            <type>typename _TYPE_</type>
          </param>
          <param>
            <type>typename _TYPE_ARRAY_</type>
          </param>
        </templateparamlist>
        <type>void</type>
        <definition>void calcul_produits_scalaires_</definition>
        <argsstring>(IJK_Vector&lt; IJK_Field_template, _TYPE_, _TYPE_ARRAY_ &gt; &amp;x, int n, int nfirst, int m, ArrOfDouble &amp;resu)</argsstring>
        <name>calcul_produits_scalaires_</name>
        <param>
          <type><ref refid="classIJK__Vector" kindref="compound">IJK_Vector</ref>&lt; <ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>, _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>x</declname>
        </param>
        <param>
          <type>int</type>
          <declname>n</declname>
        </param>
        <param>
          <type>int</type>
          <declname>nfirst</declname>
        </param>
        <param>
          <type>int</type>
          <declname>m</declname>
        </param>
        <param>
          <type><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref> &amp;</type>
          <declname>resu</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" line="508" column="13" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" bodystart="508" bodyend="542"/>
      </memberdef>
      <memberdef kind="function" id="Multigrille__base_8tpp_1a054fe3c11e72a075c1d6a69ffe358d31" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <templateparamlist>
          <param>
            <type>typename _TYPE_</type>
          </param>
          <param>
            <type>typename _TYPE_ARRAY_</type>
          </param>
        </templateparamlist>
        <type>void</type>
        <definition>void op_multiply</definition>
        <argsstring>(IJK_Field_template&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;x, _TYPE_ a)</argsstring>
        <name>op_multiply</name>
        <param>
          <type><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>x</declname>
        </param>
        <param>
          <type>_TYPE_</type>
          <declname>a</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" line="349" column="6" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" bodystart="349" bodyend="357"/>
      </memberdef>
      <memberdef kind="function" id="Multigrille__base_8tpp_1ad00ff1270d775a5518e42c9bedea93cd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <templateparamlist>
          <param>
            <type>typename _TYPE_</type>
          </param>
          <param>
            <type>typename _TYPE_ARRAY_</type>
          </param>
        </templateparamlist>
        <type>void</type>
        <definition>void op_negate</definition>
        <argsstring>(IJK_Field_template&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;x)</argsstring>
        <name>op_negate</name>
        <param>
          <type><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>x</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" line="338" column="6" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" bodystart="338" bodyend="346"/>
      </memberdef>
      <memberdef kind="function" id="Multigrille__base_8tpp_1a5d7761ea23a4372499077848636a2983" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <templateparamlist>
          <param>
            <type>typename _TYPE_</type>
          </param>
          <param>
            <type>typename _TYPE_ARRAY_</type>
          </param>
        </templateparamlist>
        <type>void</type>
        <definition>void op_sub</definition>
        <argsstring>(IJK_Field_template&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;x, const IJK_Field_template&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;y)</argsstring>
        <name>op_sub</name>
        <param>
          <type><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>x</declname>
        </param>
        <param>
          <type>const <ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template</ref>&lt; _TYPE_, _TYPE_ARRAY_ &gt; &amp;</type>
          <declname>y</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" line="360" column="6" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" bodystart="360" bodyend="371"/>
      </memberdef>
      <memberdef kind="function" id="Multigrille__base_8tpp_1ad27c6c7fbb698c75c0fc3b61f7f87d00" prot="public" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type>void</type>
        <definition>static void triangularise</definition>
        <argsstring>(const DoubleTab &amp;hessenberg, const double norme_b, DoubleTab &amp;resu, ArrOfDouble &amp;r)</argsstring>
        <name>triangularise</name>
        <param>
          <type>const <ref refid="classTRUSTTab" kindref="compound">DoubleTab</ref> &amp;</type>
          <declname>hessenberg</declname>
        </param>
        <param>
          <type>const double</type>
          <declname>norme_b</declname>
        </param>
        <param>
          <type><ref refid="classTRUSTTab" kindref="compound">DoubleTab</ref> &amp;</type>
          <declname>resu</declname>
        </param>
        <param>
          <type><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref> &amp;</type>
          <declname>r</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" line="571" column="20" bodyfile="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp" bodystart="571" bodyend="602"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/****************************************************************************</highlight></codeline>
<codeline lineno="2"><highlight class="comment">*<sp/>Copyright<sp/>(c)<sp/>2025,<sp/>CEA</highlight></codeline>
<codeline lineno="3"><highlight class="comment">*<sp/>All<sp/>rights<sp/>reserved.</highlight></codeline>
<codeline lineno="4"><highlight class="comment">*</highlight></codeline>
<codeline lineno="5"><highlight class="comment">*<sp/>Redistribution<sp/>and<sp/>use<sp/>in<sp/>source<sp/>and<sp/>binary<sp/>forms,<sp/>with<sp/>or<sp/>without<sp/>modification,<sp/>are<sp/>permitted<sp/>provided<sp/>that<sp/>the<sp/>following<sp/>conditions<sp/>are<sp/>met:</highlight></codeline>
<codeline lineno="6"><highlight class="comment">*<sp/>1.<sp/>Redistributions<sp/>of<sp/>source<sp/>code<sp/>must<sp/>retain<sp/>the<sp/>above<sp/>copyright<sp/>notice,<sp/>this<sp/>list<sp/>of<sp/>conditions<sp/>and<sp/>the<sp/>following<sp/>disclaimer.</highlight></codeline>
<codeline lineno="7"><highlight class="comment">*<sp/>2.<sp/>Redistributions<sp/>in<sp/>binary<sp/>form<sp/>must<sp/>reproduce<sp/>the<sp/>above<sp/>copyright<sp/>notice,<sp/>this<sp/>list<sp/>of<sp/>conditions<sp/>and<sp/>the<sp/>following<sp/>disclaimer<sp/>in<sp/>the<sp/>documentation<sp/>and/or<sp/>other<sp/>materials<sp/>provided<sp/>with<sp/>the<sp/>distribution.</highlight></codeline>
<codeline lineno="8"><highlight class="comment">*<sp/>3.<sp/>Neither<sp/>the<sp/>name<sp/>of<sp/>the<sp/>copyright<sp/>holder<sp/>nor<sp/>the<sp/>names<sp/>of<sp/>its<sp/>contributors<sp/>may<sp/>be<sp/>used<sp/>to<sp/>endorse<sp/>or<sp/>promote<sp/>products<sp/>derived<sp/>from<sp/>this<sp/>software<sp/>without<sp/>specific<sp/>prior<sp/>written<sp/>permission.</highlight></codeline>
<codeline lineno="9"><highlight class="comment">*</highlight></codeline>
<codeline lineno="10"><highlight class="comment">*<sp/>THIS<sp/>SOFTWARE<sp/>IS<sp/>PROVIDED<sp/>BY<sp/>THE<sp/>COPYRIGHT<sp/>HOLDERS<sp/>AND<sp/>CONTRIBUTORS<sp/>&quot;AS<sp/>IS&quot;<sp/>AND<sp/>ANY<sp/>EXPRESS<sp/>OR<sp/>IMPLIED<sp/>WARRANTIES,<sp/>INCLUDING,<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO,<sp/>THE<sp/>IMPLIED<sp/>WARRANTIES<sp/>OF<sp/>MERCHANTABILITY<sp/>AND<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE<sp/>ARE<sp/>DISCLAIMED.</highlight></codeline>
<codeline lineno="11"><highlight class="comment">*<sp/>IN<sp/>NO<sp/>EVENT<sp/>SHALL<sp/>THE<sp/>COPYRIGHT<sp/>HOLDER<sp/>OR<sp/>CONTRIBUTORS<sp/>BE<sp/>LIABLE<sp/>FOR<sp/>ANY<sp/>DIRECT,<sp/>INDIRECT,<sp/>INCIDENTAL,<sp/>SPECIAL,<sp/>EXEMPLARY,<sp/>OR<sp/>CONSEQUENTIAL<sp/>DAMAGES<sp/>(INCLUDING,<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO,<sp/>PROCUREMENT<sp/>OF<sp/>SUBSTITUTE<sp/>GOODS<sp/>OR<sp/>SERVICES;<sp/>LOSS<sp/>OF<sp/>USE,<sp/>DATA,<sp/>OR<sp/>PROFITS;</highlight></codeline>
<codeline lineno="12"><highlight class="comment">*<sp/>OR<sp/>BUSINESS<sp/>INTERRUPTION)<sp/>HOWEVER<sp/>CAUSED<sp/>AND<sp/>ON<sp/>ANY<sp/>THEORY<sp/>OF<sp/>LIABILITY,<sp/>WHETHER<sp/>IN<sp/>CONTRACT,<sp/>STRICT<sp/>LIABILITY,<sp/>OR<sp/>TORT<sp/>(INCLUDING<sp/>NEGLIGENCE<sp/>OR<sp/>OTHERWISE)<sp/>ARISING<sp/>IN<sp/>ANY<sp/>WAY<sp/>OUT<sp/>OF<sp/>THE<sp/>USE<sp/>OF<sp/>THIS<sp/>SOFTWARE,<sp/>EVEN<sp/>IF<sp/>ADVISED<sp/>OF<sp/>THE<sp/>POSSIBILITY<sp/>OF<sp/>SUCH<sp/>DAMAGE.</highlight></codeline>
<codeline lineno="13"><highlight class="comment">*</highlight></codeline>
<codeline lineno="14"><highlight class="comment">*****************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>Multigrille_base_TPP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>Multigrille_base_TPP_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;IJK_VDF_converter.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;Matrice_Morse_Sym.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;IJK_Vector.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;Interprete_bloc.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;Perf_counters.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="26" refid="classMultigrille__base_1aee5630b16ae8dfe24b91f8d1e4c023aa" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classMultigrille__base_1aee5630b16ae8dfe24b91f8d1e4c023aa" kindref="member">Multigrille_base::resoudre_systeme_IJK</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>rhs,<sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x)</highlight></codeline>
<codeline lineno="27"><highlight class="normal">{</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classMultigrille__base_1a1a7db77ecd428a100a8891a6c2deb613" kindref="member">solver_precision_</ref><sp/>==<sp/><ref refid="classMultigrille__base_1ac74aad38fc2cd7ae348291a2951ebfa3" kindref="member">precision_float_</ref>)</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/>resoudre_systeme_IJK_template&lt;float,<sp/>_TYPE_,<sp/>_TYPE_ARRAY_&gt;(rhs,<sp/>x);</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/>resoudre_systeme_IJK_template&lt;double,<sp/>_TYPE_,<sp/>_TYPE_ARRAY_&gt;(rhs,<sp/>x);</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal">}</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_FUNC_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="36" refid="classMultigrille__base_1a70e8d2fbe09418940129de9f70543885" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classMultigrille__base_1a70e8d2fbe09418940129de9f70543885" kindref="member">Multigrille_base::resoudre_systeme_IJK_template</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>rhs,<sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x)</highlight></codeline>
<codeline lineno="37"><highlight class="normal">{</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_FUNC_,TRUSTArray&lt;_TYPE_FUNC_&gt;</ref>&gt;&amp;<sp/>ijk_b<sp/>=<sp/><sp/>get_storage_template&lt;_TYPE_FUNC_&gt;(<ref refid="classMultigrille__base_1a417cb13f16dbde98fabdb3aa3eca736da4a40e0931323c413702485639387d47b" kindref="member">STORAGE_RHS</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_FUNC_,TRUSTArray&lt;_TYPE_FUNC_&gt;</ref>&gt;&amp;<sp/>ijk_x<sp/>=<sp/><sp/>get_storage_template&lt;_TYPE_FUNC_&gt;(<ref refid="classMultigrille__base_1a417cb13f16dbde98fabdb3aa3eca736da8d4f08373965286118c37fadd7144c24" kindref="member">STORAGE_X</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/>ijk_x.<ref refid="classIJK__Field__local__template_1a7e1670266e902f9084e4fc60e58c457e" kindref="member">shift_k_origin</ref>(<ref refid="classMultigrille__base_1a03ce76351d19b897838d392d6ea28d76" kindref="member">needed_kshift_for_jacobi</ref>(0)<sp/>-<sp/>ijk_x.<ref refid="classIJK__Field__local__template_1a164314830a2b8a2668c74bbf10508267" kindref="member">k_shift</ref>());</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/>j,<sp/>k;</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>imax<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>();</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jmax<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">nj</ref>();</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>kmax<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">nk</ref>();</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>kmax;<sp/>k++)</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jmax;<sp/>j++)</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>imax;<sp/>i++)</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ijk_b(i,j,k)<sp/>=<sp/>(_TYPE_FUNC_)rhs(i,j,k);</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/>solve_ijk_in_storage_template&lt;_TYPE_FUNC_&gt;();</highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>kmax;<sp/>k++)</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>jmax;<sp/>j++)</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>imax;<sp/>i++)</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x(i,j,k)<sp/>=<sp/>(_TYPE_)ijk_x(i,j,k);</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="60"><highlight class="normal">}</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Can<sp/>be<sp/>further<sp/>optimized<sp/>for<sp/>float<sp/>(extend<sp/>Schema_Comm_Vecteurs<sp/>to<sp/>float)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="65" refid="classMultigrille__base_1ac67d84173bce821cb0947cb8ef29768b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classMultigrille__base_1ac67d84173bce821cb0947cb8ef29768b" kindref="member">Multigrille_base::convert_from_ijk</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>ijk_x,<sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>x)</highlight></codeline>
<codeline lineno="66"><highlight class="normal">{</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>fetch<sp/>the<sp/>vdf_to_ijk<sp/>translator<sp/>(assume<sp/>there<sp/>is<sp/>one<sp/>unique<sp/>object,<sp/>with<sp/>conventional<sp/>name)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/>ijkdis_name<sp/>=<sp/><ref refid="classIJK__VDF__converter_1a2ddf1c81176abfca4963f456bd64ce77" kindref="member">IJK_VDF_converter::get_conventional_name</ref>();</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classIJK__VDF__converter" kindref="compound">IJK_VDF_converter</ref>&amp;<sp/>ijkdis<sp/>=<sp/>ref_cast(<ref refid="classIJK__VDF__converter" kindref="compound">IJK_VDF_converter</ref>,<sp/><ref refid="classInterprete__bloc_1ae0b05c3b185638c72c0521be856f1d4f" kindref="member">Interprete_bloc::objet_global</ref>(ijkdis_name));</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/>ijkdis.<ref refid="classIJK__VDF__converter_1aa7101ab7f56425c3079d74916ac850a5" kindref="member">get_vdf_to_ijk</ref>(<ref refid="classDomaine__IJK_1af42f29bc11c3d6e985da2a908f6e8ba3a4a01cd61239708e0c20e9fbedfa52eb6" kindref="member">Domaine_IJK::ELEM</ref>).<ref refid="classVDF__to__IJK_1a35dde7fcc1fce2ee07f97f19f0091c6b" kindref="member">convert_from_ijk</ref>(ijk_x,<sp/>x);</highlight></codeline>
<codeline lineno="71"><highlight class="normal">}</highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Can<sp/>be<sp/>further<sp/>optimized<sp/>for<sp/>float<sp/>(extend<sp/>Schema_Comm_Vecteurs<sp/>to<sp/>float)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="75" refid="classMultigrille__base_1a783c1f841ce9656fa466b3113e61e65f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classMultigrille__base_1a783c1f841ce9656fa466b3113e61e65f" kindref="member">Multigrille_base::convert_to_ijk</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>x,<sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>ijk_x)</highlight></codeline>
<codeline lineno="76"><highlight class="normal">{</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>fetch<sp/>the<sp/>vdf_to_ijk<sp/>translator<sp/>(assume<sp/>there<sp/>is<sp/>one<sp/>unique<sp/>object,<sp/>with<sp/>conventional<sp/>name)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref>&amp;<sp/>ijkdis_name<sp/>=<sp/><ref refid="classIJK__VDF__converter_1a2ddf1c81176abfca4963f456bd64ce77" kindref="member">IJK_VDF_converter::get_conventional_name</ref>();</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classIJK__VDF__converter" kindref="compound">IJK_VDF_converter</ref>&amp;<sp/>ijkdis<sp/>=<sp/>ref_cast(<ref refid="classIJK__VDF__converter" kindref="compound">IJK_VDF_converter</ref>,<sp/><ref refid="classInterprete__bloc_1ae0b05c3b185638c72c0521be856f1d4f" kindref="member">Interprete_bloc::objet_global</ref>(ijkdis_name));</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/>ijkdis.<ref refid="classIJK__VDF__converter_1aa7101ab7f56425c3079d74916ac850a5" kindref="member">get_vdf_to_ijk</ref>(<ref refid="classDomaine__IJK_1af42f29bc11c3d6e985da2a908f6e8ba3a4a01cd61239708e0c20e9fbedfa52eb6" kindref="member">Domaine_IJK::ELEM</ref>).<ref refid="classVDF__to__IJK_1affc0b52feaf24404c764eb7736d16436" kindref="member">convert_to_ijk</ref>(x,<sp/>ijk_x);</highlight></codeline>
<codeline lineno="81"><highlight class="normal">}</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="84" refid="classMultigrille__base_1ac5a69341ee38ad245e447207cb635d24" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="classMultigrille__base_1ac5a69341ee38ad245e447207cb635d24" kindref="member">Multigrille_base::multigrille</ref>(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>b,<sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>residu)</highlight></codeline>
<codeline lineno="85"><highlight class="normal">{</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classMultigrille__base_1ae02b4893932e1d2af876f34c46be7f16" kindref="member">multigrille_</ref>(x,<sp/>b,<sp/>residu,<sp/>0,<sp/>0);</highlight></codeline>
<codeline lineno="87"><highlight class="normal">}</highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Methode<sp/>recursive<sp/>qui<sp/>resout<sp/>A*x<sp/>=<sp/>b<sp/>et<sp/>calcule<sp/>residu<sp/>=<sp/>A*x-b</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>pour<sp/>le<sp/>niveau<sp/>de<sp/>grille<sp/>grid_level.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>Si<sp/>grid_level<sp/>=<sp/>niveau<sp/>grossier,<sp/>appel<sp/>a<sp/>coarse_solver,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>sinon<sp/>iterations<sp/>sur</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>pre_smoothing,<sp/>coarsening,<sp/>appel<sp/>recursif,<sp/>interpolation,<sp/>post_smoothing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight><highlight class="comment">//<sp/>input:<sp/>b</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight><highlight class="comment">//<sp/>output:<sp/>x,<sp/>residu</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight><highlight class="comment">//<sp/>return<sp/>value<sp/>=<sp/>L2<sp/>norm<sp/>of<sp/>the<sp/>residue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="98" refid="classMultigrille__base_1ae02b4893932e1d2af876f34c46be7f16" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="classMultigrille__base_1ae02b4893932e1d2af876f34c46be7f16" kindref="member">Multigrille_base::multigrille_</ref>(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>b,<sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>residu,</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>grid_level,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iter_number)</highlight></codeline>
<codeline lineno="100"><highlight class="normal">{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/>statistics().<ref refid="classPerf__counters_1ad8da7bbe3cc8b6bf63ce2c5a9c76323c" kindref="member">create_custom_counter</ref>(</highlight><highlight class="stringliteral">&quot;projection:<sp/>multigrid&quot;</highlight><highlight class="normal">,2,</highlight><highlight class="stringliteral">&quot;IJK&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>norme_residu_final<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>needed_kshift<sp/>=<sp/><ref refid="classMultigrille__base_1a03ce76351d19b897838d392d6ea28d76" kindref="member">needed_kshift_for_jacobi</ref>(grid_level<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_LATA_ALL_LEVELS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref><sp/>copy_residu_for_post(residu);</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/>copy_residu_for_post.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>()<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref><sp/>copy_x_for_post(x);</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref><sp/>copy_xini_for_post(x);</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/>copy_xini_for_post.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>()<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>();</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_X_B_AND_RESIDUE_IN_FILE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/>dump_x_b_residue_in_file(x,b,residu,<sp/>grid_level,<sp/>global_count_dump_in_file,<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;avt<sp/>pre-smooth<sp/>/<sp/>recursive<sp/>call<sp/>/<sp/>coarse<sp/>solver&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Recurse</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(grid_level<sp/>&lt;<sp/><ref refid="classMultigrille__base_1a70447f2bd566d37fcc5d4161a96ef98c" kindref="member">nb_grid_levels</ref>()<sp/>-<sp/>1)</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Pre-smooting</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>statistics().<ref refid="classPerf__counters_1a8234efa62abcd428fe3df51699090290" kindref="member">begin_count</ref>(</highlight><highlight class="stringliteral">&quot;projection:<sp/>multigrid&quot;</highlight><highlight class="normal">,statistics().get_last_opened_counter_level()+1);</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pss<sp/>=<sp/>(grid_level<sp/>&gt;=<sp/>pre_smooth_steps_.<ref refid="classTRUSTArray_1a48b5aa02624ffdc0bad44ca38ddd1a1c" kindref="member">size_array</ref>())</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>?<sp/>pre_smooth_steps_[pre_smooth_steps_.<ref refid="classTRUSTArray_1a48b5aa02624ffdc0bad44ca38ddd1a1c" kindref="member">size_array</ref>()-1]</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>pre_smooth_steps_[grid_level];</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1ae37baa318ae647a50d24c4c7500fa7dc" kindref="member">jacobi_residu</ref>(x,<sp/>&amp;b,<sp/>grid_level,<sp/>pss<sp/></highlight><highlight class="comment">/*<sp/>jacobi<sp/>iterations<sp/>*/</highlight><highlight class="normal">,<sp/>&amp;residu);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_X_B_AND_RESIDUE_IN_FILE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dump_x_b_residue_in_file(x,b,residu,<sp/>grid_level,<sp/>global_count_dump_in_file,<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;apres<sp/>pre-smooth&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_LATA_ALL_LEVELS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>copy_x_for_post.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>()<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>();</highlight></codeline>
<codeline lineno="130"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>norme_residu_final<sp/>=<sp/>norme_ijk(residu);</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(impr_)</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;level=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>grid_level<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>residu(pre)=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>norme_residu_final<sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>coarse_b<sp/>=<sp/>get_storage_template&lt;_TYPE_&gt;(<ref refid="classMultigrille__base_1a417cb13f16dbde98fabdb3aa3eca736da4a40e0931323c413702485639387d47b" kindref="member">STORAGE_RHS</ref>,<sp/>grid_level<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>coarse_x<sp/>=<sp/>get_storage_template&lt;_TYPE_&gt;(<ref refid="classMultigrille__base_1a417cb13f16dbde98fabdb3aa3eca736da8d4f08373965286118c37fadd7144c24" kindref="member">STORAGE_X</ref>,<sp/>grid_level<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>coarse_residu<sp/>=<sp/>get_storage_template&lt;_TYPE_&gt;(<ref refid="classMultigrille__base_1a417cb13f16dbde98fabdb3aa3eca736daa886df115ff91d6b68c47818969f2b4e" kindref="member">STORAGE_RESIDUE</ref>,<sp/>grid_level<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nmax<sp/>=<sp/>nb_full_mg_steps_.<ref refid="classTRUSTArray_1a48b5aa02624ffdc0bad44ca38ddd1a1c" kindref="member">size_array</ref>()<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nb_full<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(iter_number<sp/>!=<sp/>0<sp/>||<sp/>grid_level<sp/>&lt;=<sp/>1)</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(grid_level<sp/>&gt;<sp/>nmax)</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nb_full<sp/>=<sp/>nb_full_mg_steps_[nmax];</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nb_full<sp/>=<sp/>nb_full_mg_steps_[grid_level];</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fmg_step<sp/>=<sp/>0;<sp/>fmg_step<sp/>&lt;<sp/>nb_full;<sp/>fmg_step++)</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_LATA_ALL_LEVELS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>copy_residu_for_post<sp/>=<sp/>residu;</highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Coarsen<sp/>residual</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coarse_b.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>()<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1ab743ae8e3a201b2304472cc42c1af135" kindref="member">coarsen</ref>(residu,<sp/>coarse_b,<sp/>grid_level);</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>It<sp/>seems<sp/>that<sp/>the<sp/>residue<sp/>has<sp/>non<sp/>zero<sp/>sum<sp/>due<sp/>to<sp/>accumulation<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>roundoff<sp/>errors<sp/>when<sp/>computing<sp/>A*x.<sp/>At<sp/>the<sp/>coarse<sp/>level,<sp/>we<sp/>get</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>a<sp/>wrong<sp/>rhs...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1a22b3db7d514452cbf18c639b6cdcaff7" kindref="member">prepare_secmem</ref>(coarse_b);</highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>need<sp/>one<sp/>less<sp/>layer<sp/>on<sp/>b<sp/>than<sp/>on<sp/>x<sp/>to<sp/>compute<sp/>jacobi<sp/>or<sp/>residue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIJK__Shear__Periodic__helpler_1acf5f2c5df0f4172bbc1090742ffee789" kindref="member">IJK_Shear_Periodic_helpler::defilement_</ref>==0)</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//pas<sp/>sur<sp/>de<sp/>devoir<sp/>echanger<sp/>espace<sp/>virtuel<sp/>pour<sp/>le<sp/>second<sp/>membre<sp/>dans<sp/>le<sp/>cas<sp/>du<sp/>shear_perio...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coarse_b.<ref refid="classIJK__Field__template_1a34bf4952e7eeaf178687a1137f9bab1c" kindref="member">echange_espace_virtuel</ref>(b.<ref refid="classIJK__Field__local__template_1ab8d9f7787c98ce7502402a95023911a2" kindref="member">ghost</ref>()-1);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Solve<sp/>for<sp/>coarse_x</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coarse_x.<ref refid="classIJK__Field__local__template_1a7e1670266e902f9084e4fc60e58c457e" kindref="member">shift_k_origin</ref>(needed_kshift<sp/>-<sp/>coarse_x.<ref refid="classIJK__Field__local__template_1a164314830a2b8a2668c74bbf10508267" kindref="member">k_shift</ref>());</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coarse_x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>()<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//coarse_x.shift_k_origin(coarse_x.k_shift_max()<sp/>-<sp/>coarse_x.k_shift());</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_X_B_AND_RESIDUE_IN_FILE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inutile<sp/>:<sp/>idem<sp/>avt<sp/>avt-presmooth<sp/>pour<sp/>grid-level+1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>dump_x_b_residue_in_file(coarse_x,coarse_b,coarse_residu,<sp/>grid_level+1,<sp/>global_count_dump_in_file,<sp/>Nom(&quot;avt<sp/>recursive-call&quot;));</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>statistics().<ref refid="classPerf__counters_1ad528e593c4ea8c18b317fef30632b053" kindref="member">end_count</ref>(</highlight><highlight class="stringliteral">&quot;projection:<sp/>multigrid&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1ae02b4893932e1d2af876f34c46be7f16" kindref="member">multigrille_</ref>(coarse_x,<sp/>coarse_b,<sp/>coarse_residu,<sp/>grid_level+1,<sp/>fmg_step);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>statistics().<ref refid="classPerf__counters_1a8234efa62abcd428fe3df51699090290" kindref="member">begin_count</ref>(</highlight><highlight class="stringliteral">&quot;projection:<sp/>multigrid&quot;</highlight><highlight class="normal">,statistics().get_last_opened_counter_level()+1);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_X_B_AND_RESIDUE_IN_FILE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dump_x_b_residue_in_file(coarse_x,coarse_b,coarse_residu,<sp/>grid_level+1,<sp/>global_count_dump_in_file,<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;avt<sp/>interpol<sp/>/<sp/>apres<sp/>recursive-call/jacobi-residu/ou/coarse-solver<sp/>&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Interpolate<sp/>and<sp/>substract<sp/>to<sp/>x</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Shift<sp/>by<sp/>n<sp/>layers<sp/>in<sp/>k<sp/>for<sp/>the<sp/>next<sp/>jacobi_residu<sp/>call</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1a5fbb2181f5070191e03c7188b07d9796" kindref="member">interpolate_sub_shiftk</ref>(coarse_x,<sp/>x,<sp/>grid_level);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_X_B_AND_RESIDUE_IN_FILE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref><sp/>copy_x_to_compute_res(x);</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>copy_x_to_compute_res.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>()<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>();</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>g<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1ab8d9f7787c98ce7502402a95023911a2" kindref="member">ghost</ref>();</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>imin<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(-g,-g,-g);</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>imax<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(x.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">nj</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">nk</ref>()-1+g)<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(imin<sp/>==<sp/>copy_x_to_compute_res.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(-g,-g,-g));</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(imax<sp/>==<sp/>copy_x_to_compute_res.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(x.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">nj</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">nk</ref>()-1+g)<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>*ptr<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>().addr();</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>_TYPE_<sp/>*ptr2<sp/>=<sp/>copy_x_to_compute_res.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>().addr();</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>imin;<sp/>i<sp/>&lt;<sp/>imax;<sp/>i++)</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ptr[i]<sp/>-=<sp/>ptr2[i];</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jacobi_residu&lt;_TYPE_,<sp/>_TYPE_ARRAY_&gt;(copy_x_to_compute_res,<sp/>&amp;b,<sp/>grid_level,<sp/>0<sp/></highlight><highlight class="comment">/*<sp/>no<sp/>jacobi<sp/>iterations,<sp/>just<sp/>compute<sp/>residu<sp/>*/</highlight><highlight class="normal">,<sp/>&amp;residu);</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dump_x_b_residue_in_file(x,b,residu,<sp/>grid_level,<sp/>global_count_dump_in_file,<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;apres<sp/>interpol&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Post<sp/>smoothing<sp/>iterations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>postss<sp/>=<sp/>(grid_level<sp/>&gt;=<sp/>smooth_steps_.<ref refid="classTRUSTArray_1a48b5aa02624ffdc0bad44ca38ddd1a1c" kindref="member">size_array</ref>())</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>?<sp/>smooth_steps_[smooth_steps_.<ref refid="classTRUSTArray_1a48b5aa02624ffdc0bad44ca38ddd1a1c" kindref="member">size_array</ref>()-1]</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>smooth_steps_[grid_level];</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1ae37baa318ae647a50d24c4c7500fa7dc" kindref="member">jacobi_residu</ref>(x,<sp/>&amp;b,<sp/>grid_level,<sp/>postss<sp/></highlight><highlight class="comment">/*<sp/>jacobi<sp/>iterations<sp/>*/</highlight><highlight class="normal">,<sp/>&amp;residu);</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_X_B_AND_RESIDUE_IN_FILE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dump_x_b_residue_in_file(x,b,residu,<sp/>grid_level,<sp/>global_count_dump_in_file,<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;apres<sp/>post-smooth&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_LATA_ALL_LEVELS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classTRUSTArray" kindref="compound">ArrOfInt</ref><sp/>step;</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(step.<ref refid="classTRUSTArray_1a48b5aa02624ffdc0bad44ca38ddd1a1c" kindref="member">size_array</ref>()<sp/>&lt;<sp/>grid_level<sp/>+<sp/>1)</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>step.<ref refid="classTRUSTArray_1ad1bd36a32ef2d67b0a3695b5d97ac0ab" kindref="member">resize_array</ref>(grid_level<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>lata_name<sp/>=<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;Multigrid_level&quot;</highlight><highlight class="normal">)<sp/>+<sp/><ref refid="classNom" kindref="compound">Nom</ref>(grid_level)<sp/>+<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;.lata&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(step[grid_level]<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>dom<sp/>=<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;DOM&quot;</highlight><highlight class="normal">)+<ref refid="classNom" kindref="compound">Nom</ref>(grid_level);</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classDomaine__IJK" kindref="compound">Domaine_IJK</ref>&amp;<sp/>geom<sp/>=<sp/>ref_cast_non_const(<ref refid="classDomaine__IJK" kindref="compound">Domaine_IJK</ref>,x.<ref refid="classIJK__Field__template_1a6ddbb2e928ae8382ee1c398f5876fead" kindref="member">get_domaine</ref>()<sp/>);</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>geom.<ref refid="classDomaine__base_1a482e6720fc3e1468b71006846aa21d9e" kindref="member">nommer</ref>(dom);<sp/></highlight><highlight class="comment">//<sp/>On<sp/>nomme<sp/>la<sp/>geom<sp/>pour<sp/>pouvoir<sp/>l&apos;ecrire.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_header(lata_name,<sp/>x<sp/></highlight><highlight class="comment">/*<sp/>on<sp/>passe<sp/>un<sp/>champ<sp/>pour<sp/>ecrire<sp/>la<sp/>geometrie<sp/>*/</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_newtime(lata_name,step[grid_level]);</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_scalar(lata_name,<sp/></highlight><highlight class="stringliteral">&quot;xini&quot;</highlight><highlight class="normal">,<sp/>copy_x_for_post,<sp/>step[grid_level]);</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_scalar(lata_name,<sp/></highlight><highlight class="stringliteral">&quot;x1&quot;</highlight><highlight class="normal">,<sp/>copy_x_for_post,<sp/>step[grid_level]);</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_scalar(lata_name,<sp/></highlight><highlight class="stringliteral">&quot;xf&quot;</highlight><highlight class="normal">,<sp/>x,<sp/>step[grid_level]);</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_scalar(lata_name,<sp/></highlight><highlight class="stringliteral">&quot;b&quot;</highlight><highlight class="normal">,<sp/>b,<sp/>step[grid_level]);</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_scalar(lata_name,<sp/></highlight><highlight class="stringliteral">&quot;residu1&quot;</highlight><highlight class="normal">,<sp/>copy_residu_for_post,<sp/>step[grid_level]);</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_scalar(lata_name,<sp/></highlight><highlight class="stringliteral">&quot;residue&quot;</highlight><highlight class="normal">,<sp/>residu,<sp/>step[grid_level]);</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>step[grid_level]++;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>norme_residu_final<sp/>=<sp/>norme_ijk(residu);</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(impr_)</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;level=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>grid_level<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>residu=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>norme_residu_final<sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>use<sp/>threshold<sp/>criteria<sp/>only<sp/>if<sp/>pure<sp/>multigrid<sp/>(not<sp/>gcp<sp/>with<sp/>mg<sp/>preconditionning)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(grid_level<sp/>==<sp/>0<sp/>&amp;&amp;<sp/>norme_residu_final<sp/>&lt;<sp/>seuil_<sp/>&amp;&amp;<sp/>max_iter_gcp_<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>statistics().<ref refid="classPerf__counters_1ad528e593c4ea8c18b317fef30632b053" kindref="member">end_count</ref>(</highlight><highlight class="stringliteral">&quot;projection:<sp/>multigrid&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>statistics().<ref refid="classPerf__counters_1a8234efa62abcd428fe3df51699090290" kindref="member">begin_count</ref>(</highlight><highlight class="stringliteral">&quot;projection:<sp/>multigrid&quot;</highlight><highlight class="normal">,statistics().get_last_opened_counter_level()+1);</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_X_B_AND_RESIDUE_IN_FILE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inutile<sp/>:<sp/>idem<sp/>avt<sp/>avt-presmooth<sp/>pour<sp/>grid-level</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>dump_x_b_residue_in_file(x,b,residu,<sp/>grid_level,<sp/>global_count_dump_in_file,<sp/>Nom(&quot;avt<sp/>coarse-solver&quot;));</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1af18270f77115a6ae23832efc78d55a44" kindref="member">coarse_solver</ref>(x,<sp/>b);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_X_B_AND_RESIDUE_IN_FILE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inutile<sp/>:<sp/>idem<sp/>avt<sp/>interpol</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>dump_x_b_residue_in_file(x,b,residu,<sp/>grid_level,<sp/>global_count_dump_in_file,<sp/>Nom(&quot;apres<sp/>coarse-solver&quot;));</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1ae37baa318ae647a50d24c4c7500fa7dc" kindref="member">jacobi_residu</ref>(x,<sp/>&amp;b,<sp/>grid_level,<sp/>0<sp/></highlight><highlight class="comment">/*<sp/>not<sp/>jacobi<sp/>*/</highlight><highlight class="normal">,<sp/>&amp;residu);</highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_X_B_AND_RESIDUE_IN_FILE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inutile<sp/>:<sp/>idem<sp/>avt<sp/>interpol</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>dump_x_b_residue_in_file(x,b,residu,<sp/>grid_level,<sp/>global_count_dump_in_file,<sp/>Nom(&quot;apres<sp/>jacobi-residu&quot;));</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>norme_residu_final<sp/>=<sp/>norme_ijk(residu);</highlight></codeline>
<codeline lineno="271"><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(impr_)</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/>finl<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;level=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>grid_level<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>residu=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>norme_residu_final</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>(coarse<sp/>solver)&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DUMP_LATA_ALL_LEVELS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classTRUSTArray" kindref="compound">ArrOfInt</ref><sp/>step;</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(step.<ref refid="classTRUSTArray_1a48b5aa02624ffdc0bad44ca38ddd1a1c" kindref="member">size_array</ref>()<sp/>&lt;<sp/>grid_level<sp/>+<sp/>1)</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>step.<ref refid="classTRUSTArray_1ad1bd36a32ef2d67b0a3695b5d97ac0ab" kindref="member">resize_array</ref>(grid_level<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>lata_name<sp/>=<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;Multigrid_level&quot;</highlight><highlight class="normal">)<sp/>+<sp/><ref refid="classNom" kindref="compound">Nom</ref>(grid_level)<sp/>+<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;.lata&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(step[grid_level]<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classNom" kindref="compound">Nom</ref><sp/>dom<sp/>=<sp/><ref refid="classNom" kindref="compound">Nom</ref>(</highlight><highlight class="stringliteral">&quot;DOM&quot;</highlight><highlight class="normal">)+<ref refid="classNom" kindref="compound">Nom</ref>(grid_level);</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x.get_splitting_non_const().get_grid_geometry_non_const().<ref refid="classField__base_1a517704cb3a892cbe30c12e0d744277c7" kindref="member">nommer</ref>(dom);<sp/></highlight><highlight class="comment">//<sp/>On<sp/>nomme<sp/>la<sp/>geom<sp/>pour<sp/>pouvoir<sp/>l&apos;ecrire.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_header(lata_name,<sp/>x<sp/></highlight><highlight class="comment">/*<sp/>on<sp/>passe<sp/>un<sp/>champ<sp/>pour<sp/>ecrire<sp/>la<sp/>geometrie<sp/>*/</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_newtime(lata_name,step[grid_level]);</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_scalar(lata_name,<sp/></highlight><highlight class="stringliteral">&quot;x&quot;</highlight><highlight class="normal">,<sp/>x,<sp/>step[grid_level]);</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_scalar(lata_name,<sp/></highlight><highlight class="stringliteral">&quot;b&quot;</highlight><highlight class="normal">,<sp/>b,<sp/>step[grid_level]);</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dumplata_scalar(lata_name,<sp/></highlight><highlight class="stringliteral">&quot;residue&quot;</highlight><highlight class="normal">,<sp/>residu,<sp/>step[grid_level]);</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>step[grid_level]++;</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>statistics().<ref refid="classPerf__counters_1ad528e593c4ea8c18b317fef30632b053" kindref="member">end_count</ref>(</highlight><highlight class="stringliteral">&quot;projection:<sp/>multigrid&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>norme_residu_final;</highlight></codeline>
<codeline lineno="299"><highlight class="normal">}</highlight></codeline>
<codeline lineno="300"><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="302" refid="classMultigrille__base_1af18270f77115a6ae23832efc78d55a44" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classMultigrille__base_1af18270f77115a6ae23832efc78d55a44" kindref="member">Multigrille_base::coarse_solver</ref>(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>b)</highlight></codeline>
<codeline lineno="303"><highlight class="normal">{</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMatrice__Grossiere" kindref="compound">Matrice_Grossiere</ref>&amp;<sp/>mat<sp/>=<sp/>coarse_matrix_;</highlight></codeline>
<codeline lineno="305"><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref><sp/>inco;</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref><sp/>secmem;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMD__Vector" kindref="compound">MD_Vector</ref>&amp;<sp/>md<sp/>=<sp/>mat.<ref refid="classMatrice__Grossiere_1a24ce0dbc952d200b9e9b2c9fa4f4e39d" kindref="member">md_vector</ref>();</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/>inco.<ref refid="classTRUSTVect_1ae68bc2c6cfd7016c9c209cddd41e51d4" kindref="member">resize</ref>(md-&gt;<ref refid="classMD__Vector__base_1abb6438093dfd60b817caea07517659ef" kindref="member">get_nb_items_tot</ref>());</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/>inco.<ref refid="classTRUSTVect_1a553ba300d28558d12d2f8d7ee5249b00" kindref="member">set_md_vector</ref>(md);</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/>secmem<sp/>=<sp/>inco;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"></highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ni<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>();</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nj<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">nj</ref>();</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nk<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">nk</ref>();</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/>j,<sp/>k;</highlight></codeline>
<codeline lineno="317"><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>nk;<sp/>k++)</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>nj;<sp/>j++)</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>ni;<sp/>i++)</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secmem[mat.<ref refid="classMatrice__Grossiere_1a53b04ae29577f214e4b56e678e27eaec" kindref="member">renum</ref>(i,j,k)]<sp/>=<sp/>b(i,j,k);</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//pas<sp/>sur<sp/>de<sp/>devoir<sp/>echanger<sp/>espace<sp/>virtuel<sp/>pour<sp/>le<sp/>second<sp/>membre<sp/>dans<sp/>le<sp/>cas<sp/>du<sp/>shear_perio...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIJK__Shear__Periodic__helpler_1acf5f2c5df0f4172bbc1090742ffee789" kindref="member">IJK_Shear_Periodic_helpler::defilement_</ref>==0)</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>secmem.<ref refid="classTRUSTVect_1a17969227082b6532c960a56745facfd8" kindref="member">echange_espace_virtuel</ref>();</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/>solveur_grossier_.<ref refid="classSolveurSys_1a62ca198f0c5dc599e53b0535761e5138" kindref="member">resoudre_systeme</ref>(mat.<ref refid="classMatrice__Grossiere_1a298e33d2ec9e39fc0643427734451ea1" kindref="member">matrice</ref>(),<sp/>secmem,<sp/>inco);</highlight></codeline>
<codeline lineno="329"><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>nk;<sp/>k++)</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>nj;<sp/>j++)</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>ni;<sp/>i++)</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x(i,j,k)<sp/>=<sp/>(_TYPE_)inco[mat.<ref refid="classMatrice__Grossiere_1a53b04ae29577f214e4b56e678e27eaec" kindref="member">renum</ref>(i,j,k)];<sp/></highlight><highlight class="comment">//!!!!!!!!!!!!!!!!!!<sp/>ToDo<sp/>WARNING:<sp/>potentiellement<sp/>conversion<sp/>de<sp/>double<sp/>en<sp/>float!!!!!!!!!!!!!!!!!!!!!!!!!!!!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal">}</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>op_negate(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x)</highlight></codeline>
<codeline lineno="339"><highlight class="normal">{</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>g<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1ab8d9f7787c98ce7502402a95023911a2" kindref="member">ghost</ref>();</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>imin<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(-g,-g,-g);</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>imax<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(x.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">nj</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">nk</ref>()-1+g)<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>*ptr<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>().addr();</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>imin;<sp/>i<sp/>&lt;<sp/>imax;<sp/>i++)</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr[i]<sp/>=<sp/>-ptr[i];</highlight></codeline>
<codeline lineno="346"><highlight class="normal">}</highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>op_multiply(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/>_TYPE_<sp/>a)</highlight></codeline>
<codeline lineno="350"><highlight class="normal">{</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>g<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1ab8d9f7787c98ce7502402a95023911a2" kindref="member">ghost</ref>();</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>imin<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(-g,-g,-g);</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>imax<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(x.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">nj</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">nk</ref>()-1+g)<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>*ptr<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>().addr();</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>imin;<sp/>i<sp/>&lt;<sp/>imax;<sp/>i++)</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr[i]<sp/>*=<sp/>a;</highlight></codeline>
<codeline lineno="357"><highlight class="normal">}</highlight></codeline>
<codeline lineno="358"><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>op_sub(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>y)</highlight></codeline>
<codeline lineno="361"><highlight class="normal">{</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>g<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1ab8d9f7787c98ce7502402a95023911a2" kindref="member">ghost</ref>();</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>imin<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(-g,-g,-g);</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>imax<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(x.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">nj</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">nk</ref>()-1+g)<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/>assert(imin<sp/>==<sp/>y.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(-g,-g,-g));</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/>assert(imax<sp/>==<sp/>y.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(x.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">nj</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">nk</ref>()-1+g)<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>*ptr<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>().addr();</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>_TYPE_<sp/>*ptr2<sp/>=<sp/>y.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>().addr();</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>imin;<sp/>i<sp/>&lt;<sp/>imax;<sp/>i++)</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr[i]<sp/>-=<sp/>ptr2[i];</highlight></codeline>
<codeline lineno="371"><highlight class="normal">}</highlight></codeline>
<codeline lineno="372"><highlight class="normal"></highlight></codeline>
<codeline lineno="373"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ajoute_alpha_v(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/>_TYPE_<sp/>alpha,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>v)</highlight></codeline>
<codeline lineno="375"><highlight class="normal">{</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>g<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1ab8d9f7787c98ce7502402a95023911a2" kindref="member">ghost</ref>();</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>imin<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(-g,-g,-g);</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>imax<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(x.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">nj</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">nk</ref>()-1+g)<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/>assert(imin<sp/>==<sp/>v.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(-g,-g,-g));</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/>assert(imax<sp/>==<sp/>v.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(x.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">nj</ref>()-1+g,<sp/>x.<ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">nk</ref>()-1+g)<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>*ptr<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>().addr();</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>_TYPE_<sp/>*ptr2<sp/>=<sp/>v.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>().addr();</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>imin;<sp/>i<sp/>&lt;<sp/>imax;<sp/>i++)</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr[i]<sp/>+=<sp/>alpha<sp/>*<sp/>ptr2[i];</highlight></codeline>
<codeline lineno="385"><highlight class="normal">}</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Ne<sp/>semble<sp/>pas<sp/>fonctionner<sp/>(manque<sp/>juste<sp/>echange<sp/>espace<sp/>virtuel<sp/>sur<sp/>second<sp/>membre<sp/>?)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="389" refid="classMultigrille__base_1ab7f7650943a8c7be971a03ba505c307e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classMultigrille__base_1ab7f7650943a8c7be971a03ba505c307e" kindref="member">Multigrille_base::resoudre_avec_gcp</ref>(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>b,<sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>residu)</highlight></codeline>
<codeline lineno="390"><highlight class="normal">{</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref><sp/>Z,<sp/>P,<sp/>R;</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><ref refid="classMultigrille__base_1ab7e9b37816f427593adca79128ba7a9d" kindref="member">alloc_field</ref>(Z,<sp/>0);</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><ref refid="classMultigrille__base_1ab7e9b37816f427593adca79128ba7a9d" kindref="member">alloc_field</ref>(P,<sp/>0);</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><ref refid="classMultigrille__base_1ab7e9b37816f427593adca79128ba7a9d" kindref="member">alloc_field</ref>(R,<sp/>0);</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/>x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>()<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/>R.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>()<sp/>=<sp/>b.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>();</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/>op_negate(R);</highlight></codeline>
<codeline lineno="398"><highlight class="normal"></highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><ref refid="classMultigrille__base_1ac5a69341ee38ad245e447207cb635d24" kindref="member">multigrille</ref>(P,<sp/>R,<sp/>residu);</highlight></codeline>
<codeline lineno="400"><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>dold<sp/>=<sp/>prod_scal_ijk(R,<sp/>P);</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/>op_negate(P);</highlight></codeline>
<codeline lineno="403"><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iter<sp/>=<sp/>0;<sp/>iter<sp/>&lt;<sp/>max_iter_gcp_;<sp/>iter++)</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>calcul<sp/>de<sp/>AP<sp/>=<sp/>A<sp/>*<sp/>P</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1ae37baa318ae647a50d24c4c7500fa7dc" kindref="member">jacobi_residu</ref>(P,<sp/>0<sp/></highlight><highlight class="comment">/*<sp/>secmem<sp/>*/</highlight><highlight class="normal">,<sp/>0<sp/></highlight><highlight class="comment">/*<sp/>grid_level<sp/>*/</highlight><highlight class="normal">,<sp/>0<sp/></highlight><highlight class="comment">/*<sp/>no<sp/>jacobi<sp/>*/</highlight><highlight class="normal">,<sp/>&amp;residu);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>alpha<sp/>=<sp/>dold<sp/>/<sp/>prod_scal_ijk(P,<sp/>residu);</highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;alpha=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>alpha<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>normeP=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>norme_ijk(P)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>dold=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>dold<sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ajoute_alpha_v(x,<sp/>alpha,<sp/>P);</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ajoute_alpha_v(R,<sp/>alpha,<sp/>residu);</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>nr<sp/>=<sp/>(_TYPE_)norme_ijk(R);</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;GCP+MG<sp/>iteration<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>iter<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>residu<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>nr<sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nr<sp/>&lt;<sp/>seuil_)</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(iter<sp/>==<sp/>max_iter_gcp_)</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Non<sp/>convergence<sp/>de<sp/>Multigrille_poreux::resoudre_avec_gcp<sp/>en<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>max_iter_gcp_</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>iterations&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="428"><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>preconditionner</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1ac5a69341ee38ad245e447207cb635d24" kindref="member">multigrille</ref>(Z,<sp/>R,<sp/>residu);</highlight></codeline>
<codeline lineno="431"><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>prodscal_RZ<sp/>=<sp/>prod_scal_ijk(R,<sp/>Z);</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>beta<sp/>=<sp/>prodscal_RZ<sp/>/<sp/>dold;</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>dold<sp/>=<sp/>prodscal_RZ;</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>op_multiply(P,<sp/>beta);</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>op_sub(P,<sp/>Z);</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="439"><highlight class="normal">}</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>ajouter_alpha_v_multiple_(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref>&amp;<sp/>coeff,<sp/><ref refid="classIJK__Vector" kindref="compound">IJK_Vector&lt;IJK_Field_template, _TYPE_, _TYPE_ARRAY_&gt;</ref>&amp;<sp/>y,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nfirst)</highlight></codeline>
<codeline lineno="443"><highlight class="normal">{</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&gt;<sp/>4)</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Erreur<sp/>ajouter_alpha_v_multiple&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classProcess_1acc2fbbe761e08e5870ae605c0705491c" kindref="member">Process::exit</ref>();</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ni<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a05abe70b988f06b647c55447a401e8a1" kindref="member">ni</ref>();</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nj<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a0b04ee03ff119133a0e6f3a69236f1f0" kindref="member">nj</ref>();</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nk<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1ac2bb2c86b0767595409f700cadf3b772" kindref="member">nk</ref>();</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>*<sp/>x_ptr<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>().addr();</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>*<sp/>y_ptr[4];</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>c[4];</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nn;</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>somme<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(nn<sp/>=<sp/>0;<sp/>nn<sp/>&lt;<sp/>n;<sp/>nn++)</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y_ptr[nn]<sp/>=<sp/>y[nfirst<sp/>+<sp/>nn].data().addr();</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>c[nn]<sp/>=<sp/>(_TYPE_)coeff[nfirst<sp/>+<sp/>nn];</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>nk;<sp/>k++)</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>nj;<sp/>j++)</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>index<sp/>=<sp/>x.<ref refid="classIJK__Field__local__template_1a1e9b8fda1c7579cbac7a78a495bca1ba" kindref="member">linear_index</ref>(0,j,k);</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>ni;<sp/>i++)</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>val<sp/>=<sp/>x_ptr[index+i];</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(nn<sp/>=<sp/>0;<sp/>nn<sp/>&lt;<sp/>n;<sp/>nn++)</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>val<sp/>+=<sp/>c[nn]<sp/>*<sp/>y_ptr[nn][index+i];</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x_ptr[index+i]<sp/>=<sp/>val;</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>somme<sp/>+=<sp/>val<sp/>*<sp/>val;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>somme;</highlight></codeline>
<codeline lineno="478"><highlight class="normal">}</highlight></codeline>
<codeline lineno="479"><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Calcule<sp/>ceci</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>x<sp/>+=<sp/>coeff[0]<sp/>*<sp/>y[0]<sp/>+<sp/>...<sp/>+<sp/>coeff[n-1]<sp/>*<sp/>y[n-1]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Renvoie<sp/>la<sp/>somme<sp/>des<sp/>x^2<sp/>du<sp/>resultat<sp/>sur<sp/>le<sp/>processeur<sp/>local</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>ajouter_alpha_v_multiple(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref>&amp;<sp/>coeff,<sp/><ref refid="classIJK__Vector" kindref="compound">IJK_Vector&lt;IJK_Field_template, _TYPE_, _TYPE_ARRAY_&gt;</ref>&amp;<sp/>y,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n)</highlight></codeline>
<codeline lineno="485"><highlight class="normal">{</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>somme<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(i<sp/>&lt;<sp/>n)</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nn<sp/>=<sp/>n<sp/>-<sp/>i;</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nn<sp/>&gt;<sp/>4)</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nn<sp/>=<sp/>4;</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nn<sp/>==<sp/>1)</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>somme<sp/>+=<sp/>ajouter_alpha_v_multiple_(x,<sp/>coeff,<sp/>y,<sp/>1,<sp/>i);</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nn<sp/>==<sp/>2)</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>somme<sp/>+=<sp/>ajouter_alpha_v_multiple_(x,<sp/>coeff,<sp/>y,<sp/>2,<sp/>i);</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nn<sp/>==<sp/>3)</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>somme<sp/>+=<sp/>ajouter_alpha_v_multiple_(x,<sp/>coeff,<sp/>y,<sp/>3,<sp/>i);</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nn<sp/>==<sp/>4)</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>somme<sp/>+=<sp/>ajouter_alpha_v_multiple_(x,<sp/>coeff,<sp/>y,<sp/>4,<sp/>i);</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>+=<sp/>nn;</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>somme;</highlight></codeline>
<codeline lineno="505"><highlight class="normal">}</highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>calcul_produits_scalaires_(<ref refid="classIJK__Vector" kindref="compound">IJK_Vector&lt;IJK_Field_template, _TYPE_, _TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nfirst,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>m,<sp/><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref>&amp;<sp/>resu)</highlight></codeline>
<codeline lineno="509"><highlight class="normal">{</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&gt;<sp/>4)</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Erreur<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classProcess_1acc2fbbe761e08e5870ae605c0705491c" kindref="member">Process::exit</ref>();</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ni<sp/>=<sp/>x[0].ni();</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nj<sp/>=<sp/>x[0].nj();</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nk<sp/>=<sp/>x[0].nk();</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>*<sp/>x_ptr<sp/>=<sp/>x[m].data().addr();</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>*<sp/>y_ptr[4];</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/>_TYPE_<sp/>c[4]<sp/>=<sp/>{<sp/>0.,<sp/>0.,<sp/>0.,<sp/>0.<sp/>};</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nn;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(nn<sp/>=<sp/>0;<sp/>nn<sp/>&lt;<sp/>n;<sp/>nn++)</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y_ptr[nn]<sp/>=<sp/>x[nfirst<sp/>+<sp/>nn].data().addr();</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>c[nn]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>nk;<sp/>k++)</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>nj;<sp/>j++)</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>index<sp/>=<sp/>x[0].linear_index(0,j,k);</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>ni;<sp/>i++)</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_TYPE_<sp/>val<sp/>=<sp/>x_ptr[index+i];</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(nn<sp/>=<sp/>0;<sp/>nn<sp/>&lt;<sp/>n;<sp/>nn++)</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>c[nn]<sp/>+=<sp/>val<sp/>*<sp/>y_ptr[nn][index+i];</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(nn<sp/>=<sp/>0;<sp/>nn<sp/>&lt;<sp/>n;<sp/>nn++)</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/>resu[nfirst<sp/>+<sp/>nn]<sp/>+=<sp/>c[nn];</highlight></codeline>
<codeline lineno="542"><highlight class="normal">}</highlight></codeline>
<codeline lineno="543"><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Calcule<sp/>ceci,<sp/>pour<sp/>i=0..n<sp/>avec<sp/>n<sp/>=<sp/>resu.size_array()-1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>resu[i]<sp/>=<sp/>x[i]<sp/>scalaire<sp/>x[n]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Renvoie<sp/>la<sp/>somme<sp/>des<sp/>x^2<sp/>du<sp/>resultat<sp/>sur<sp/>le<sp/>processeur<sp/>local</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>calcul_produits_scalaires(<ref refid="classIJK__Vector" kindref="compound">IJK_Vector&lt;IJK_Field_template, _TYPE_, _TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref>&amp;<sp/>resu)</highlight></codeline>
<codeline lineno="549"><highlight class="normal">{</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/>resu<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>resu.<ref refid="classTRUSTArray_1a48b5aa02624ffdc0bad44ca38ddd1a1c" kindref="member">size_array</ref>()<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(i<sp/>&lt;<sp/>n)</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nn<sp/>=<sp/>n<sp/>-<sp/>i;</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nn<sp/>&gt;<sp/>4)</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nn<sp/>=<sp/>4;</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nn<sp/>==<sp/>1)</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>calcul_produits_scalaires_(x,<sp/>1,<sp/>i,<sp/>n,<sp/>resu);</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nn<sp/>==<sp/>2)</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>calcul_produits_scalaires_(x,<sp/>2,<sp/>i,<sp/>n,<sp/>resu);</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nn<sp/>==<sp/>3)</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>calcul_produits_scalaires_(x,<sp/>3,<sp/>i,<sp/>n,<sp/>resu);</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nn<sp/>==<sp/>4)</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>calcul_produits_scalaires_(x,<sp/>4,<sp/>i,<sp/>n,<sp/>resu);</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>+=<sp/>nn;</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/>mp_sum_for_each_item(resu);</highlight></codeline>
<codeline lineno="569"><highlight class="normal">}</highlight></codeline>
<codeline lineno="570"><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>triangularise(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classTRUSTTab" kindref="compound">DoubleTab</ref>&amp;<sp/>hessenberg,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>norme_b,<sp/><ref refid="classTRUSTTab" kindref="compound">DoubleTab</ref>&amp;<sp/>resu,<sp/><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref>&amp;<sp/>r)</highlight></codeline>
<codeline lineno="572"><highlight class="normal">{</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>hessenberg.<ref refid="classTRUSTTab_1aee55d6851cd43d179ec3c46262fa0aad" kindref="member">dimension</ref>(1);</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/>assert(hessenberg.<ref refid="classTRUSTTab_1aee55d6851cd43d179ec3c46262fa0aad" kindref="member">dimension</ref>(0)<sp/>==<sp/>n+1);</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/>assert(r.<ref refid="classTRUSTArray_1a48b5aa02624ffdc0bad44ca38ddd1a1c" kindref="member">size_array</ref>()<sp/>==<sp/>n<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/>r[0]<sp/>=<sp/>norme_b;</highlight></codeline>
<codeline lineno="578"><highlight class="normal"></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Triangularisation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>n;<sp/>i++)</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>ccos,<sp/>ssin;</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>h_ii<sp/>=<sp/>hessenberg(i,<sp/>i);</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>h_i1i<sp/>=<sp/>hessenberg(i<sp/>+<sp/>1,<sp/>i);</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>tmp_val<sp/>=<sp/>1.<sp/>/<sp/>sqrt(h_ii<sp/>*<sp/>h_ii<sp/>+<sp/>h_i1i<sp/>*<sp/>h_i1i);</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ccos<sp/>=<sp/>h_ii<sp/>*<sp/>tmp_val;</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssin<sp/>=<sp/>-<sp/>h_i1i<sp/>*<sp/>tmp_val;</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>i;<sp/>j<sp/>&lt;<sp/>n;<sp/>j++)</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>h_ij<sp/>=<sp/>hessenberg(i,<sp/>j);</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>h_i1j<sp/>=<sp/>hessenberg(i<sp/>+<sp/>1,<sp/>j);</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>resu(i,<sp/>j)<sp/><sp/><sp/><sp/><sp/>=<sp/>ccos<sp/>*<sp/>h_ij<sp/>-<sp/>ssin<sp/>*<sp/>h_i1j;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>resu(i<sp/>+<sp/>1,<sp/>j)<sp/>=<sp/>ssin<sp/>*<sp/>h_ij<sp/>+<sp/>ccos<sp/>*<sp/>h_i1j;</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>ri<sp/>=<sp/>r[i];</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r[i]<sp/>=<sp/>ccos<sp/>*<sp/>ri;</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r[i<sp/>+<sp/>1]<sp/>=<sp/>ssin<sp/>*<sp/>ri;</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="602"><highlight class="normal">}</highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"></highlight><highlight class="comment">//<sp/>si<sp/>plus<sp/>de<sp/>3<sp/>vecteurs<sp/>de<sp/>base,<sp/>semble<sp/>atteindre<sp/>la<sp/>limite<sp/>de<sp/>precision<sp/>numerique...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="606" refid="classMultigrille__base_1aaf946ac987f0f0bdbeeaa76b5281d339" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classMultigrille__base_1aaf946ac987f0f0bdbeeaa76b5281d339" kindref="member">Multigrille_base::resoudre_avec_gmres</ref>(<ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>x,<sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>b,<sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>residu)</highlight></codeline>
<codeline lineno="607"><highlight class="normal">{</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_krilov<sp/>=<sp/>n_krilov_;</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><ref refid="classTRUSTTab" kindref="compound">DoubleTab</ref><sp/>hessenberg(n_krilov<sp/>+<sp/>1,<sp/>n_krilov);</highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Espace<sp/>de<sp/>Krilov</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Vector" kindref="compound">IJK_Vector&lt;IJK_Field_template, _TYPE_, _TYPE_ARRAY_&gt;</ref><sp/>krilov_space;</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Vecteurs<sp/>des<sp/>M^(-1)<sp/>*<sp/>krilov_space[i]<sp/>ou<sp/>M^-1<sp/>est<sp/>le<sp/>preconditionneur:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Vector" kindref="compound">IJK_Vector&lt;IJK_Field_template, _TYPE_, _TYPE_ARRAY_&gt;</ref><sp/>m_krilov_space;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref><sp/>titi;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ii=0;<sp/>ii<sp/>&lt;<sp/>n_krilov+1;<sp/>ii++)</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>krilov_space.<ref refid="classTRUST__Vector_1a7ea36b65d43d6563da8a2ab1dd292ce8" kindref="member">add</ref>(titi);</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ii=0;<sp/>ii<sp/>&lt;<sp/>n_krilov;<sp/>ii++)</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>m_krilov_space.<ref refid="classTRUST__Vector_1a7ea36b65d43d6563da8a2ab1dd292ce8" kindref="member">add</ref>(titi);</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="622"><highlight class="normal"></highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/>krilov_space[0]<sp/>=<sp/>b;</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ii=0;<sp/>ii<sp/>&lt;<sp/>n_krilov;<sp/>ii++)</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1ab7e9b37816f427593adca79128ba7a9d" kindref="member">alloc_field</ref>(krilov_space[ii+1],<sp/>0);</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1ab7e9b37816f427593adca79128ba7a9d" kindref="member">alloc_field</ref>(m_krilov_space[ii],<sp/>0,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal"><sp/></highlight><highlight class="comment">/*<sp/>with<sp/>additional<sp/>layers<sp/>for<sp/>jacobi<sp/>sweeps<sp/>*/</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="629"><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/>x.<ref refid="classIJK__Field__local__template_1a7557798c384c81b392b53902ecabf221" kindref="member">data</ref>()<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="631"><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iter<sp/>=<sp/>0;<sp/>;<sp/>iter++)</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="634"><highlight class="normal"></highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Hypothese<sp/>de<sp/>depart:<sp/>krilov_space[0]<sp/>=<sp/>-residu</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>norme_b<sp/>=<sp/>norme_ijk(krilov_space[0]);</highlight></codeline>
<codeline lineno="637"><highlight class="normal"></highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(impr_gmres_)</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;gmres<sp/>iteration<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>iter<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>norme(residu)<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>norme_b<sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(norme_b<sp/>&lt;<sp/>seuil_<sp/>||<sp/>norme_b<sp/>==<sp/>0.)</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(impr_gmres_)</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;gmres:<sp/>norme(residu)<sp/>&lt;<sp/>seuil=&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>seuil_<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>=&gt;<sp/>return&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(iter<sp/>&gt;=<sp/>max_iter_gmres_)</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cerr<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>in<sp/>Multigrille_base::resoudre_avec_gmres:<sp/>did<sp/>not<sp/>converge<sp/>in<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>max_iter_gmres_<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>restarts.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;\n<sp/>Residue=<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>norme_b<sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classProcess_1acc2fbbe761e08e5870ae605c0705491c" kindref="member">Process::exit</ref>();</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>krilov_space[0].data()<sp/>*=<sp/>(_TYPE_)(1.<sp/>/<sp/>norme_b);</highlight></codeline>
<codeline lineno="653"><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>hessenberg<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="655"><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>n_krilov;<sp/>i++)</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Produit<sp/>matrice<sp/>vecteur<sp/>:<sp/>v1<sp/>=<sp/>A<sp/>*<sp/>M^(-1)<sp/>*<sp/>v0<sp/><sp/>(ou<sp/>M^(-1)<sp/>est<sp/>une<sp/>approx<sp/>de<sp/>A^(-1)<sp/>par<sp/>multigrille)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m_krilov_space[i].data()<sp/>=<sp/>0.;</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m_krilov_space[i].shift_k_origin(<ref refid="classMultigrille__base_1a03ce76351d19b897838d392d6ea28d76" kindref="member">needed_kshift_for_jacobi</ref>(0)<sp/>-<sp/>m_krilov_space[i].k_shift());</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>krilov_space[i].echange_espace_virtuel(krilov_space[i].ghost());</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Stockage<sp/>de<sp/>M^-1<sp/>*<sp/>v0<sp/>dans<sp/>m_krilov_space[i]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>et<sp/>on<sp/>met<sp/>le<sp/>residu<sp/>dans<sp/>krilov_space[i+1]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1ac5a69341ee38ad245e447207cb635d24" kindref="member">multigrille</ref>(m_krilov_space[i],<sp/>krilov_space[i],<sp/>krilov_space[i+1]);</highlight></codeline>
<codeline lineno="665"><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>remarque<sp/>Titi23</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>On<sp/>obtient<sp/>krilov_space[i+1]<sp/>=<sp/>A<sp/>*<sp/>m_krilov_space[i]<sp/>-<sp/>krilov_space[i]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>normalement,<sp/>on<sp/>devrait<sp/>faire</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>krilov_space[i+1]<sp/>+=<sp/>krilov_space[i]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>L&apos;orthogonalisation<sp/>va<sp/>retirer<sp/>la<sp/>composante<sp/>krilov_space[i],</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>mais<sp/>va<sp/>calculer<sp/>&quot;prod_scal_ijk(krilov_space[i+1],<sp/>krilov_space[i])<sp/>-<sp/>1&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"></highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Orthogonalisation:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>v0<sp/>=<sp/>somme<sp/>pour<sp/>0<sp/>&lt;=<sp/>j<sp/>&lt;=<sp/>i<sp/>des<sp/>(krilov_space[j]<sp/>*<sp/>hessenberg(j,<sp/>i)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref><sp/>produit_scal(i+2);</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref><sp/>coeff(i+1);</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>calcul_produits_scalaires(krilov_space,<sp/>produit_scal);</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;=<sp/>i;<sp/>j++)</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>h<sp/>=<sp/>produit_scal[j];</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coeff[j]<sp/>=<sp/>-h;</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//norme2_prevue<sp/>-=<sp/>h*h;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(j<sp/>==<sp/>i)</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>voir<sp/>Titi23<sp/>ci-dessus:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>on<sp/>n&apos;a<sp/>pas<sp/>rajoute<sp/>krilov_space[i]<sp/>toute<sp/>a<sp/>l&apos;heure<sp/>a<sp/>krilov_space[i+1],</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>le<sp/>produit<sp/>scalaire<sp/>a<sp/>stocker<sp/>dans<sp/>hessenberg<sp/>vaut<sp/>donc<sp/>1<sp/>de<sp/>plus:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>h<sp/>+=<sp/>1.;</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hessenberg(j,<sp/>i)<sp/>=<sp/>h;</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>norme_v0<sp/>=<sp/>ajouter_alpha_v_multiple(krilov_space[i+1],<sp/>coeff,<sp/>krilov_space,<sp/>i+1);</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>norme_v0<sp/>=<sp/>sqrt(<ref refid="classProcess_1a7d23bc1ef94b3f0623fbc79d034c27fd" kindref="member">mp_sum</ref>(norme_v0));</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hessenberg(i<sp/>+<sp/>1,<sp/>i)<sp/>=<sp/>norme_v0;</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>krilov_space[i+1].data()<sp/>*=<sp/>(_TYPE_)(1.<sp/>/<sp/>norme_v0);</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="697"><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classTRUSTTab" kindref="compound">DoubleTab</ref><sp/>mat(n_krilov<sp/>+<sp/>1,<sp/>n_krilov);</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classTRUSTArray" kindref="compound">ArrOfDouble</ref><sp/>r__(n_krilov<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>triangularise(hessenberg,<sp/>norme_b,<sp/>mat,<sp/>r__);</highlight></codeline>
<codeline lineno="701"><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//...Solution<sp/>of<sp/>linear<sp/>system</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>n_krilov<sp/>-<sp/>1;<sp/>i<sp/>&gt;=<sp/>0;<sp/>i--)</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r__[i]<sp/>/=<sp/>mat(i,<sp/>i);</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>i-1;<sp/>j<sp/>&gt;=<sp/>0;<sp/>j--)</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r__[j]<sp/>-=<sp/>mat(j,<sp/>i)<sp/>*<sp/>r__[i];</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ajouter_alpha_v_multiple(x,<sp/>r__,<sp/>m_krilov_space,<sp/>n_krilov);</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(impr_gmres_)</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;facteurs<sp/>r<sp/>:<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>r__.<ref refid="classTRUSTArray_1a48b5aa02624ffdc0bad44ca38ddd1a1c" kindref="member">size_array</ref>();<sp/>i++)</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/>r__[i]<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(impr_gmres_<sp/>&gt;<sp/>1)</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;matrice<sp/>de<sp/>hessenberg<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>hessenberg<sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>On<sp/>stocke<sp/>le<sp/>residu<sp/>dans<sp/>krilov_space[0]<sp/>pour<sp/>l&apos;iteration<sp/>suivante:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1ae37baa318ae647a50d24c4c7500fa7dc" kindref="member">jacobi_residu</ref>(x,<sp/>&amp;b,<sp/>0<sp/></highlight><highlight class="comment">/*<sp/>grid_level<sp/>*/</highlight><highlight class="normal">,<sp/>0<sp/></highlight><highlight class="comment">/*<sp/>no<sp/>jacobi<sp/>*/</highlight><highlight class="normal">,<sp/>&amp;krilov_space[0]);</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classMultigrille__base_1a22b3db7d514452cbf18c639b6cdcaff7" kindref="member">prepare_secmem</ref>(krilov_space[0]);</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>op_negate(krilov_space[0]);</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="726"><highlight class="normal">}</highlight></codeline>
<codeline lineno="727"><highlight class="normal"></highlight></codeline>
<codeline lineno="728"><highlight class="normal"></highlight></codeline>
<codeline lineno="729"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>_TYPE_ARRAY_&gt;</highlight></codeline>
<codeline lineno="730" refid="classMultigrille__base_1adb2c7f4e7b774975859be76b539816dd" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classMultigrille__base_1adb2c7f4e7b774975859be76b539816dd" kindref="member">Multigrille_base::resoudre_systeme_template</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMatrice__Base" kindref="compound">Matrice_Base</ref>&amp;<sp/>a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>b,<sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref>&amp;<sp/>x)</highlight></codeline>
<codeline lineno="731"><highlight class="normal">{</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>ijk_b<sp/>=<sp/>get_storage_template&lt;_TYPE_&gt;(<ref refid="classMultigrille__base_1a417cb13f16dbde98fabdb3aa3eca736da4a40e0931323c413702485639387d47b" kindref="member">STORAGE_RHS</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><ref refid="classIJK__Field__template" kindref="compound">IJK_Field_template&lt;_TYPE_,_TYPE_ARRAY_&gt;</ref>&amp;<sp/>ijk_x<sp/>=<sp/>get_storage_template&lt;_TYPE_&gt;(<ref refid="classMultigrille__base_1a417cb13f16dbde98fabdb3aa3eca736da8d4f08373965286118c37fadd7144c24" kindref="member">STORAGE_X</ref>,<sp/>0)<sp/>;</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/>ijk_x.<ref refid="classIJK__Field__local__template_1a7e1670266e902f9084e4fc60e58c457e" kindref="member">shift_k_origin</ref>(<ref refid="classMultigrille__base_1a03ce76351d19b897838d392d6ea28d76" kindref="member">needed_kshift_for_jacobi</ref>(0)<sp/>-<sp/>ijk_x.<ref refid="classIJK__Field__local__template_1a164314830a2b8a2668c74bbf10508267" kindref="member">k_shift</ref>());</highlight></codeline>
<codeline lineno="735"><highlight class="normal"></highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><ref refid="classMultigrille__base_1a783c1f841ce9656fa466b3113e61e65f" kindref="member">convert_to_ijk</ref>(b,<sp/>ijk_b);</highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/>solve_ijk_in_storage_template&lt;_TYPE_&gt;();</highlight></codeline>
<codeline lineno="739"><highlight class="normal"></highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><ref refid="classMultigrille__base_1ac67d84173bce821cb0947cb8ef29768b" kindref="member">convert_from_ijk</ref>(ijk_x,<sp/>x);</highlight></codeline>
<codeline lineno="741"><highlight class="normal"></highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/>x.<ref refid="classTRUSTVect_1a17969227082b6532c960a56745facfd8" kindref="member">echange_espace_virtuel</ref>();</highlight></codeline>
<codeline lineno="743"><highlight class="normal"></highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(check_residu_)</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Calcul<sp/>du<sp/>residu</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classTRUSTVect" kindref="compound">DoubleVect</ref><sp/>residu(b);</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>a.<ref refid="classMatrice__Base_1a91c98b86a0bdce6ccc483dd453ef9ab2" kindref="member">multvect</ref>(x,<sp/>residu);</highlight></codeline>
<codeline lineno="749"><highlight class="normal"></highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMatrice__Bloc" kindref="compound">Matrice_Bloc</ref>&amp;<sp/>matrice_bloc=ref_cast(<ref refid="classMatrice__Bloc" kindref="compound">Matrice_Bloc</ref>,a);</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classMatrice__Morse__Sym" kindref="compound">Matrice_Morse_Sym</ref>&amp;<sp/>la_matrice<sp/>=ref_cast(<ref refid="classMatrice__Morse__Sym" kindref="compound">Matrice_Morse_Sym</ref>,matrice_bloc.<ref refid="classMatrice__Bloc_1a76a5691fecfea8b4dd877d2c449a7f21" kindref="member">get_bloc</ref>(0,0).valeur());</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Terme<sp/>diagonal<sp/>multiplie<sp/>par<sp/>2<sp/>dans<sp/>Assembleur_P_VDF.cpp:<sp/>assembler_QC()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classProcess_1acd052b99706c577f8a5b6656217cf4c2" kindref="member">Process::je_suis_maitre</ref>())</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>residu[0]<sp/>-=<sp/>x[0]<sp/>*<sp/>la_matrice(0,0)<sp/>*<sp/>0.5;</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Norme<sp/>de<sp/>Ax<sp/>et<sp/>residu:<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>mp_norme_vect(residu);</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>residu<sp/>-=<sp/>b;</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Cout<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>mp_norme_vect(residu)<sp/>&lt;&lt;<sp/>finl;</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="759"><highlight class="normal"></highlight></codeline>
<codeline lineno="760"><highlight class="normal">}</highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"></highlight></codeline>
<codeline lineno="763"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
    </programlisting>
    <location file="/volatile/catA/gj277443/TRUST/sync-doc/src/IJK/Multigrille/Multigrille_base.tpp"/>
  </compounddef>
</doxygen>
